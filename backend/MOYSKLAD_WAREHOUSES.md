# Настройка складов МойСклад

## Текущая конфигурация

Система синхронизирует остатки товаров **только** со следующих складов:

1. **Склад Toolbox 4** - `b58e534f-b91d-11ee-0a80-0107003c27c9`
2. **Toolbox 1 Рай.Маг** - `742f8e44-ed82-11ed-0a80-00cb009f538f`
3. **Toolbox 2 Дон Бозори** - `5b25bcb2-d1d8-11ed-0a80-0e1e0028a95d`
4. **Toolbox 4 Бетонка** - `815df250-bce8-11ee-0a80-0f0b001b27f6`

## Как работает синхронизация

- Джоб `sync-moysklad-stock` запускается **каждые 15 минут**
- Использует API endpoint `/report/stock/bystore` для получения остатков по всем складам
- **Фильтрует и суммирует** остатки только с выбранных 4 складов
- Обновляет инвентарь в Medusa

## Как изменить список складов

### 1. Посмотреть все доступные склады

```bash
cd backend
MOYSKLAD_TOKEN=ваш_токен node list-warehouses.js
```

### 2. Обновить конфигурацию

Откройте файл `backend/src/modules/moysklad/service.ts` и найдите константу `WAREHOUSE_IDS`:

```typescript
// Warehouse IDs to sync stock from
const WAREHOUSE_IDS = [
  'b58e534f-b91d-11ee-0a80-0107003c27c9', // Склад Toolbox 4
  '742f8e44-ed82-11ed-0a80-00cb009f538f', // Toolbox 1 Рай.Маг
  '5b25bcb2-d1d8-11ed-0a80-0e1e0028a95d', // Toolbox 2 Дон Бозори
  '815df250-bce8-11ee-0a80-0f0b001b27f6', // Toolbox 4 Бетонка
]
```

Добавьте или удалите ID складов по необходимости.

### 3. Пересобрать и задеплоить

```bash
cd backend
pnpm build
# Затем задеплойте на Railway
```

## Тестирование

Проверить фильтрацию складов можно командой:

```bash
cd backend
MOYSKLAD_TOKEN=ваш_токен node test-warehouse-filter.js
```

Это покажет первые 5 товаров с разбивкой по складам и пометками выбранных складов.

## Все доступные склады в системе

1. **Yandex** - `0c0577c4-5666-11f0-0a80-18ef000c9fad`
2. **Toolbox Карши** - `1f13381e-eb81-11f0-0a80-1a220082b9ed`
3. **Toolbox 2 Дон Бозори** - `5b25bcb2-d1d8-11ed-0a80-0e1e0028a95d` ✅
4. **Товары на фулфилменд** - `6065ac68-fbc6-11ee-0a80-02a9000a0cb7`
5. **Toolbox 1 Рай.Маг** - `742f8e44-ed82-11ed-0a80-00cb009f538f` ✅
6. **Toolbox 4 Бетонка** - `815df250-bce8-11ee-0a80-0f0b001b27f6` ✅
7. **Сервис** - `8aa52d05-3f4f-11ef-0a80-104c0005743a`
8. **Toolbox запчасти магазин** - `a92d908a-bd08-11ef-0a80-0ddf00195c11`
9. **Отдел бракованных товаров** - `b15e1352-36ab-11ef-0a80-0cbf0026afb4`
10. **Склад Toolbox 4** - `b58e534f-b91d-11ee-0a80-0107003c27c9` ✅
11. **Uzum** - `d143c690-81b8-11ed-0a80-07fe000463ea`
12. **wildberries** - `d8041a72-d9fb-11ee-0a80-158c00339097`
13. **Склад B2B** - `e1088adb-1fc1-11ee-0a80-08c300083b21`
14. **Toolbox Damas van** - `f1a5ad46-4c70-11ed-0a80-0784001a9243`
15. **Отдел доноров** - `f9c7091b-9d3b-11f0-0a80-0f5800362b86`

✅ - Склады, с которых сейчас синхронизируются остатки
