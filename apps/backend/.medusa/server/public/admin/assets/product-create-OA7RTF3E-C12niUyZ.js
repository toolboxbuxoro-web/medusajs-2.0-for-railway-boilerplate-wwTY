import{C as oe}from"./chunk-X5VECN6S-CERnBNDq.js";import{H as Re}from"./chunk-7OYLCEKK-CoUmDBBY.js";import{u as Be,a as He,b as Ke,c as Le}from"./chunk-Y2XQE25L-CXiQ_qEG.js";import{C as qe}from"./chunk-XGJ5DXXG-B9DqTySj.js";import{u as G}from"./chunk-HFB3OQXI-D-mb50b6.js";import{C as U}from"./chunk-2PMSBTXI-BdzS7q8P.js";import{n as Ge,P as Ue,a as We,U as Xe,d as ce}from"./chunk-FJJLUQFG-BP8d-2T7.js";import"./chunk-ZQRKUG6J-oe6_18ZO.js";import{D as A,c as Ze,a as Qe}from"./chunk-Q4ST7H7M-CBSbtt5y.js";import{C as Ye}from"./chunk-XDJ7OMBR-CCjVHgq4.js";import{r as N,b as E,h as Je,i as et,l as tt,m as st,j as e,a as le,n as rt,o as at,v as $,s as B,t as te,B as F,F as fe,D as nt,H as J,w as o,I as Z,x as L,y as ge,z as Q,C as ve,K as je,P as be,E as ye,G as Ce,J as Ne,S as we,M as ae,N as X,Q as lt,R as H,T as it,U as q,V as ot,W as ct,k as dt,X as _e,A as Se,Y as Pe,Z as Ve,_ as Te}from"./index-BpfPnGdZ.js";import{D as ut,c as mt}from"./chunk-ONULGYMV-BQt2UhWy.js";import{S as Ie}from"./chunk-D7H6ZNK4-fg5EigE4.js";import{K as pt}from"./chunk-6HTZNHPT-VlvzTJFv.js";import{R as O,u as ke,S as R,a as ht}from"./chunk-4TC5YS65-DibKdFAA.js";import{P as D}from"./progress-tabs-xhh61ah2.js";import{T as xt}from"./textarea-Dl-JCye7.js";import{A as se}from"./alert-N-NMZIr-.js";import{X as Ee}from"./x-mark-mini-hOCHhWa9.js";import{T as de}from"./Trans-CBu9SpTd.js";import{D as ie}from"./dots-six-CDwOCJLY.js";import{T as ze}from"./thumbnail-badge-cyNroKAH.js";import{T as ft}from"./trash-CDEOtOav.js";import{C as ue}from"./checkbox-DCa7E6TW.js";import"./chunk-2D44OO7A-Cgshkru_.js";import"./chunk-PFKKVLZX-DLCEsDIG.js";import"./chunk-Q33G337Z-DuTP9Yqa.js";import"./chunk-C76H5USB-Dd196HiU.js";import"./triangles-mini-MGL63xRf.js";import"./plus-mini-DwCGy8dy.js";import"./chunk-TYTNUPXB-CiYXXoUN.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-Y2RYZS5B-DyMrZ3o1.js";import"./_isIndex-CA4sJ4fU.js";import"./adjustments-CM1kR1Ir.js";import"./command-bar-CZwuJqwH.js";import"./select-BWHoKjkd.js";import"./check-vtHah2d6.js";import"./date-picker-BXzAAwZh.js";import"./popover-Dgs2umtn.js";import"./triangle-left-mini-CizkIkwI.js";import"./table-DW79ophy.js";import"./arrow-up-mini-ywWVFkNt.js";import"./use-prompt-Cv7F2RTx.js";import"./prompt-CpsPiMDa.js";import"./pencil-square-B6or-DO4.js";var gt=Object.defineProperty,Y=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,me=(t,s,r)=>s in t?gt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,vt=(t,s)=>{for(var r in s||(s={}))De.call(s,r)&&me(t,r,s[r]);if(Y)for(var r of Y(s))Fe.call(s,r)&&me(t,r,s[r]);return t},jt=(t,s)=>{var r={};for(var l in t)De.call(t,l)&&s.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&Y)for(var l of Y(t))s.indexOf(l)<0&&Fe.call(t,l)&&(r[l]=t[l]);return r};const Me=N.forwardRef((t,s)=>{var r=t,{color:l="currentColor"}=r,n=jt(r,["color"]);return N.createElement("svg",vt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},n),N.createElement("path",{stroke:l,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});Me.displayName="StackPerspective";var bt=({form:t})=>{const{t:s}=E();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(o.Field,{control:t.control,name:"title",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("products.fields.title.label")}),e.jsx(o.Control,{children:e.jsx(Z,{...r,placeholder:s("products.fields.title.placeholder")})})]})}),e.jsx(o.Field,{control:t.control,name:"subtitle",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.subtitle.label")}),e.jsx(o.Control,{children:e.jsx(Z,{...r,placeholder:s("products.fields.subtitle.placeholder")})})]})}),e.jsx(o.Field,{control:t.control,name:"handle",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{tooltip:s("products.fields.handle.tooltip"),optional:!0,children:s("fields.handle")}),e.jsx(o.Control,{children:e.jsx(Re,{...r,placeholder:s("products.fields.handle.placeholder")})})]})})]})}),e.jsx(o.Field,{control:t.control,name:"description",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(o.Control,{children:e.jsx(xt,{...r,placeholder:s("products.fields.description.placeholder")})})]})})]})},yt={sideEffects:Ne({styles:{active:{opacity:"0.4"}}})},Ct=({form:t})=>{const{fields:s,append:r,remove:l}=L({name:"media",control:t.control,keyName:"field_id"}),[n,a]=N.useState(null),u=ge(Q(be),Q(je,{coordinateGetter:ve})),h=f=>{a(f.active.id)},m=f=>{a(null);const{active:_,over:C}=f;if(_.id!==(C==null?void 0:C.id)){const P=s.findIndex(g=>g.field_id===_.id),z=s.findIndex(g=>g.field_id===(C==null?void 0:C.id));t.setValue("media",_e(s,P,z),{shouldDirty:!0,shouldTouch:!0})}},x=()=>{a(null)},i=f=>()=>{l(f)},d=f=>()=>{const _=s.map((C,P)=>({...C,isThumbnail:P===f}));t.setValue("media",_,{shouldDirty:!0,shouldTouch:!0})},v=f=>({onDelete:i(f),onMakeThumbnail:d(f)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(Xe,{form:t,append:r,showHint:!1}),e.jsxs(ye,{sensors:u,onDragEnd:m,onDragStart:h,onDragCancel:x,children:[e.jsx(Ce,{dropAnimation:yt,children:n?e.jsx(wt,{field:s.find(f=>f.field_id===n)}):null}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:e.jsx(we,{items:s.map(f=>f.field_id),children:s.map((f,_)=>{const{onDelete:C,onMakeThumbnail:P}=v(_);return e.jsx(Nt,{field:f,onDelete:C,onMakeThumbnail:P},f.field_id)})})})]})]})},Nt=({field:t,onDelete:s,onMakeThumbnail:r})=>{const{t:l}=E(),{attributes:n,listeners:a,setNodeRef:u,setActivatorNodeRef:h,transform:m,transition:x,isDragging:i}=Ve({id:t.field_id}),d={opacity:i?.4:void 0,transform:Te.Translate.toString(m),transition:x};return t.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",ref:u,style:d,children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",type:"button",size:"small",...n,...a,ref:h,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(q,{size:"small",leading:"compact",children:t.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(q,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:$e(t.file.size)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Se,{groups:[{actions:[{label:l("products.media.makeThumbnail"),icon:e.jsx(Me,{}),onClick:r}]},{actions:[{icon:e.jsx(ft,{}),label:l("actions.delete"),onClick:s}]}]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:s,children:e.jsx(Pe,{})})]})]}):null},wt=({field:t})=>{var s,r;return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(H,{variant:"transparent",size:"small",className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Oe,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(q,{size:"small",leading:"compact",children:(s=t.file)==null?void 0:s.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(ze,{}),e.jsx(q,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:$e(((r=t.file)==null?void 0:r.size)??0)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Se,{groups:[]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",onClick:()=>{},children:e.jsx(Pe,{})})]})]})},Oe=({url:t})=>t?e.jsx("img",{src:t,alt:"",className:"size-full object-cover object-center"}):null;function $e(t,s=2){if(t===0)return"0 Bytes";const r=1024,l=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(s))+" "+l[n]}var _t=({items:t,onChange:s,renderItem:r})=>{const[l,n]=N.useState(null),[a,u]=N.useMemo(()=>{if(l===null)return[null,null];const d=t.findIndex(({id:v})=>v===l.id);return[t[d],d]},[l,t]),h=ge(Q(be),Q(je,{coordinateGetter:ve})),m=({active:d})=>{n(d)},x=({active:d,over:v})=>{if(v&&d.id!==v.id){const f=t.findIndex(({id:C})=>C===d.id),_=t.findIndex(({id:C})=>C===v.id);s(_e(t,f,_))}n(null)},i=()=>{n(null)};return e.jsxs(ye,{sensors:h,onDragStart:m,onDragEnd:x,onDragCancel:i,children:[e.jsx(Pt,{children:a&&u!==null?r(a,u):null}),e.jsx(we,{items:t,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:t.map((d,v)=>e.jsx(N.Fragment,{children:r(d,v)},d.id))})})]})},St={sideEffects:Ne({styles:{active:{opacity:"0.4"}}})},Pt=({children:t})=>e.jsx(Ce,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:St,children:t}),Ae=N.createContext(null),Vt=()=>{const t=N.useContext(Ae);if(!t)throw new Error("useSortableItemContext must be used within a SortableItemContext");return t},Tt=({id:t,className:s,children:r})=>{const{attributes:l,isDragging:n,listeners:a,setNodeRef:u,setActivatorNodeRef:h,transform:m,transition:x}=Ve({id:t}),i=N.useMemo(()=>({attributes:l,listeners:a,ref:h,isDragging:n}),[l,a,h,n]),d={opacity:n?.4:void 0,transform:Te.Translate.toString(m),transition:x};return e.jsx(Ae.Provider,{value:i,children:e.jsx("li",{className:ae("transition-fg flex flex-1 list-none",s),ref:u,style:d,children:r})})},It=()=>{const{attributes:t,listeners:s,ref:r}=Vt();return e.jsx(H,{variant:"transparent",size:"small",...t,...s,ref:r,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ie,{className:"text-ui-fg-muted"})})},re=Object.assign(_t,{Item:Tt,DragHandle:It}),ne=t=>{if(t.length===0)return[];if(t.length===1)return t[0].values.map(l=>({[t[0].title]:l}));const s=t[0],r=t.slice(1);return s.values.flatMap(l=>ne(r).map(n=>({[s.title]:l,...n})))},pe=t=>Object.values(t).join(" / "),kt=({form:t})=>{var C,P,z;const{t:s}=E(),r=L({control:t.control,name:"options"}),l=L({control:t.control,name:"variants"}),n=$({control:t.control,name:"enable_variants",defaultValue:!1}),a=$({control:t.control,name:"options",defaultValue:[]}),u=$({control:t.control,name:"variants",defaultValue:[]}),h=!!((C=t.formState.errors.options)!=null&&C.length),m=((z=(P=t.formState.errors.variants)==null?void 0:P.root)==null?void 0:z.message)==="invalid_length",x=(g,p)=>{const{isTouched:c}=t.getFieldState("variants"),j=[...a];j[g].values=p;const y=ne(j.filter(({values:b})=>b.length)),w=[...u],I=b=>y.find(M=>Object.keys(b).every(T=>b[T]===M[T])),V=w.reduce((b,M)=>{const T=I(M.options);return T&&b.push({...M,title:pe(T),options:T}),b},[]),k=new Set(V.map(b=>b.options));y.filter(b=>!k.has(b)).forEach(b=>{V.push({title:pe(b),options:b,should_create:!c,variant_rank:V.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),t.setValue("variants",V)},i=g=>{if(g===0)return;r.remove(g);const p=[...a];p.splice(g,1);const c=new Set(p.map(I=>I.title)),j=ne(p),y=[...u],w=j.reduce((I,V)=>{const k=y.find(({options:S})=>Object.keys(S).filter(b=>c.has(b)).every(b=>S[b]===V[b]));return k&&I.push({...k,title:k.title,options:V}),I},[]);t.setValue("variants",w)},d=g=>{const p=g.map((c,j)=>{const y=u.find(w=>w.title===c.title);return{id:c.id,...y||c,variant_rank:j}});l.replace(p)},v=g=>g.every(p=>p.should_create)?!0:g.some(p=>p.should_create)?"indeterminate":!1,f=g=>{switch(g){case!0:{const p=u.map(c=>({...c,should_create:!0}));t.setValue("variants",p);break}case!1:{const p=u.map(c=>({...c,should_create:!1}));t.setValue("variants",ce(p));break}}},_=()=>{t.setValue("options",[{title:"Default option",values:["Default option value"]}]),t.setValue("variants",ce([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(J,{level:"h2",children:s("products.create.variants.header")}),e.jsx(Ie,{control:t.control,name:"enable_variants",label:s("products.create.variants.subHeadingTitle"),description:s("products.create.variants.subHeadingDescription"),onCheckedChange:g=>{g?(t.setValue("options",[{title:"",values:[]}]),t.setValue("variants",[])):_()}})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(o.Field,{control:t.control,name:"options",render:()=>e.jsx(o.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:s("products.create.variants.productOptions.label")}),e.jsx(o.Hint,{children:s("products.create.variants.productOptions.hint")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{r.append({title:"",values:[]})},children:s("actions.add")})]}),h&&e.jsx(se,{dismissible:!0,variant:"error",children:s("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:r.fields.map((g,p)=>{var j;const c=!!((j=t.formState.errors.options)!=null&&j[p]);return e.jsxs("li",{className:ae("bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",{"border-ui-border-error shadow-borders-error":c}),children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${p}.title`,children:s("fields.title")})}),e.jsx(Z,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...t.register(`options.${p}.title`),placeholder:s("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${p}.values`,children:s("fields.values")})}),e.jsx(lt,{control:t.control,name:`options.${p}.values`,render:({field:{onChange:y,...w}})=>{const I=V=>{x(p,V),y(V)};return e.jsx(Ye,{...w,variant:"contrast",onChange:I,placeholder:s("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:p===0,onClick:()=>i(p),children:e.jsx(Ee,{})})]},g.id)})})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(X,{weight:"plus",children:s("products.create.variants.productVariants.label")}),e.jsx(it,{children:s("products.create.variants.productVariants.hint")})]}),!h&&m&&e.jsx(se,{dismissible:!0,variant:"error",children:s("products.create.errors.variants")}),l.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${a.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(ue,{className:"relative",checked:v(u),onCheckedChange:f})}),e.jsx("div",{}),a.map((g,p)=>e.jsx("div",{children:e.jsx(q,{size:"small",leading:"compact",weight:"plus",children:g.title})},p))]}),e.jsx(re,{items:l.fields,onChange:d,renderItem:(g,p)=>e.jsx(re.Item,{id:g.id,className:ae("bg-ui-bg-base border-b",{"border-b-0":p===l.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${a.length}, 1fr)`},children:[e.jsx(o.Field,{control:t.control,name:`variants.${p}.should_create`,render:({field:{value:c,onChange:j,...y}})=>e.jsx(o.Item,{children:e.jsx(o.Control,{children:e.jsx(ue,{className:"relative",...y,checked:c,onCheckedChange:j})})})}),e.jsx(re.DragHandle,{}),Object.values(g.options).map((c,j)=>e.jsx(q,{size:"small",leading:"compact",children:c},j))]})})})]}):e.jsx(se,{children:s("products.create.variants.productVariants.alert")}),l.fields.length>0&&e.jsx(ot,{label:s("general.tip"),children:s("products.create.variants.productVariants.tip")})]})})]})]})},Et=({form:t})=>{const{getFormFields:s}=le(),r=s("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(zt,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(bt,{form:t}),e.jsx(fe,{fields:r,form:t}),e.jsx(Ct,{form:t})]}),e.jsx(nt,{}),e.jsx(kt,{form:t})]})})},zt=()=>{const{t}=E();return e.jsx("div",{className:"flex flex-col",children:e.jsx(J,{children:t("products.create.header")})})};function Dt({form:t,variantIndex:s,inventoryIndex:r,inventoryItem:l,isItemOptionDisabled:n,onRemove:a}){const{t:u}=E(),h=$({control:t.control,name:`variants.${s}.inventory.${r}.inventory_item_id`}),m=G({queryKey:["inventory_items"],defaultValueKey:"id",selectedValue:h,queryFn:x=>B.admin.inventoryItem.list(x),getOptions:x=>x.inventory_items.map(i=>({label:`${i.title} ${i.sku?`(${i.sku})`:""}`,value:i.id}))});return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${s}.inventory.${r}.inventory_item_id`,children:u("fields.item")})}),e.jsx(o.Field,{control:t.control,name:`variants.${s}.inventory.${r}.inventory_item_id`,render:({field:x})=>e.jsx(o.Item,{children:e.jsx(o.Control,{children:e.jsx(U,{...x,options:m.options.map(i=>({...i,disabled:n(i,r)})),searchValue:m.searchValue,onBlur:()=>m.onSearchValueChange(""),onSearchValueChange:m.onSearchValueChange,fetchNextPage:m.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:u("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(X,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${s}.inventory.${r}.required_quantity`,children:u("fields.quantity")})}),e.jsx(o.Field,{control:t.control,name:`variants.${s}.inventory.${r}.required_quantity`,render:({field:{onChange:x,value:i,...d}})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(Z,{type:"number",className:"bg-ui-bg-field-component",min:0,value:i,onChange:v=>{const f=v.target.value;x(f===""?null:Number(f))},...d,placeholder:u("products.create.inventory.quantityPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:a,children:e.jsx(Ee,{})})]},l.id)}function Ft({form:t,variant:s,index:r}){const{t:l}=E(),n=L({control:t.control,name:`variants.${r}.inventory`}),a=$({control:t.control,name:`variants.${r}.inventory`}),u=(h,m)=>!!(a!=null&&a.some((x,i)=>i!=m&&x.inventory_item_id===h.value));return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:s.title}),e.jsx(o.Hint,{children:l("products.create.inventory.label")})]}),e.jsx(F,{size:"small",variant:"secondary",type:"button",onClick:()=>{n.append({inventory_item_id:"",required_quantity:""})},children:l("actions.add")})]}),n.fields.map((h,m)=>e.jsx(Dt,{form:t,variantIndex:r,inventoryIndex:m,inventoryItem:h,isItemOptionDisabled:u,onRemove:()=>n.remove(m)},h.id))]})}var Mt=({form:t})=>{const{t:s}=E(),r=L({control:t.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(J,{children:s("products.create.inventory.heading")}),r.fields.filter(l=>l.inventory_kit).map((l,n)=>e.jsx(Ft,{form:t,variant:l,index:n},l.id))]})},Ot=({form:t})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx(Mt,{form:t})})}),$t=({form:t})=>{const{t:s}=E(),r=G({queryKey:["product_collections"],queryFn:i=>B.admin.productCollection.list(i),getOptions:i=>i.collections.map(d=>({label:d.title,value:d.id}))}),l=G({queryKey:["product_types"],queryFn:i=>B.admin.productType.list(i),getOptions:i=>i.product_types.map(d=>({label:d.value,value:d.id}))}),n=G({queryKey:["product_tags"],queryFn:i=>B.admin.productTag.list(i),getOptions:i=>i.product_tags.map(d=>({label:d.value,value:d.id}))}),a=G({queryKey:["shipping_profiles"],queryFn:i=>B.admin.shippingProfile.list(i),getOptions:i=>i.shipping_profiles.map(d=>({label:d.name,value:d.id}))}),{fields:u,remove:h,replace:m}=L({control:t.control,name:"sales_channels",keyName:"key"}),x=()=>{m([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(J,{children:s("products.organization.header")}),e.jsx(Ie,{control:t.control,name:"discountable",label:s("products.fields.discountable.label"),description:s("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(o.Field,{control:t.control,name:"type_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.type.label")}),e.jsx(o.Control,{children:e.jsx(U,{...i,options:l.options,searchValue:l.searchValue,onSearchValueChange:l.onSearchValueChange,fetchNextPage:l.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"collection_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.collection.label")}),e.jsx(o.Control,{children:e.jsx(U,{...i,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(o.Field,{control:t.control,name:"categories",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.categories.label")}),e.jsx(o.Control,{children:e.jsx(qe,{...i})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"tags",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.tags.label")}),e.jsx(o.Control,{children:e.jsx(U,{...i,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,fetchNextPage:n.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.shipping_profile.label")}),e.jsx(o.Hint,{children:e.jsx(de,{i18nKey:"products.fields.shipping_profile.hint"})})]}),e.jsx(o.Field,{control:t.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(U,{...i,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(o.Field,{control:t.control,name:"sales_channels",render:()=>e.jsxs(o.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(o.Label,{optional:!0,children:s("products.fields.sales_channels.label")}),e.jsx(o.Hint,{children:e.jsx(de,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx(R.Trigger,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:s("actions.add")})})]}),e.jsx(o.Control,{className:"mt-0",children:u.length>0&&e.jsx(oe,{onClearAll:x,onRemove:h,className:"py-4",children:u.map((i,d)=>e.jsx(oe.Chip,{index:d,children:i.name},i.key))})})]})})})]})},W="sc",he=20,At=({form:t})=>{const{t:s}=E(),{getValues:r,setValue:l}=t,{setIsOpen:n,getIsOpen:a}=ht(),[u,h]=N.useState({}),[m,x]=N.useState([]),i=Be({pageSize:he,prefix:W}),{sales_channels:d,count:v,isLoading:f,isError:_,error:C}=ct(i,{placeholderData:dt}),P=a(W);N.useEffect(()=>{if(!P)return;const y=r("sales_channels");y&&(x(y.map(w=>({id:w.id,name:w.name}))),h(y.reduce((w,I)=>({...w,[I.id]:!0}),{})))},[P,r]);const z=y=>{const w=Object.keys(y),I=new Set(w.filter(k=>y[k]&&!u[k]));let V=[];I.size>0&&(V=(d==null?void 0:d.filter(k=>I.has(k.id)))??[]),x(k=>{const S=k.filter(b=>y[b.id]);return Array.from(new Set([...S,...V]))}),h(y)},g=()=>{l("sales_channels",m,{shouldDirty:!0,shouldTouch:!0}),n(W,!1)},p=He(),c=Bt(),j=Ke();if(_)throw C;return e.jsxs(R.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx(R.Header,{}),e.jsx(R.Body,{className:"flex-1 overflow-hidden",children:e.jsx(ut,{data:d,columns:c,filters:p,emptyState:j,rowCount:v,pageSize:he,getRowId:y=>y.id,rowSelection:{state:u,onRowSelectionChange:z},isLoading:f,layout:"fill",prefix:W})}),e.jsx(R.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(R.Close,{asChild:!0,children:e.jsx(F,{size:"small",variant:"secondary",type:"button",children:s("actions.cancel")})}),e.jsx(F,{size:"small",onClick:g,type:"button",children:s("actions.save")})]})})]})},Rt=mt(),Bt=()=>{const t=Le();return N.useMemo(()=>[Rt.select(),...t],[t])},Ht=({form:t})=>{const{getFormFields:s}=le(),r=s("product","create","organize");return e.jsxs(R,{id:W,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx($t,{form:t}),e.jsx(fe,{fields:r,form:t})]})}),e.jsx(At,{form:t})]})},Kt=({form:t,regions:s,store:r,pricePreferences:l})=>{const{setCloseOnEscape:n}=ke(),a=N.useMemo(()=>{var i;return((i=r==null?void 0:r.supported_currencies)==null?void 0:i.map(d=>d.currency_code))||[]},[r]),u=$({control:t.control,name:"variants",defaultValue:[]}),h=$({control:t.control,name:"options",defaultValue:[]}),m=Lt({options:h,currencies:a,regions:s,pricePreferences:l}),x=N.useMemo(()=>{const i=[];return u.forEach((d,v)=>{d.should_create&&i.push({...d,originalIndex:v})}),i},[u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(A,{columns:m,data:x,state:t,onEditingChange:i=>n(!i)})})},K=Ze(),Lt=({options:t,currencies:s=[],regions:r=[],pricePreferences:l=[]})=>{const{t:n}=E();return N.useMemo(()=>[K.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t.map(a=>a.title).join(" / ")})}),cell:a=>e.jsx(A.ReadonlyCell,{context:a,children:t.map(u=>a.row.original.options[u.title]).join(" / ")}),disableHiding:!0}),K.column({id:"title",name:n("fields.title"),header:n("fields.title"),field:a=>`variants.${a.row.original.originalIndex}.title`,type:"text",cell:a=>e.jsx(A.TextCell,{context:a})}),K.column({id:"sku",name:n("fields.sku"),header:n("fields.sku"),field:a=>`variants.${a.row.original.originalIndex}.sku`,type:"text",cell:a=>e.jsx(A.TextCell,{context:a})}),K.column({id:"manage_inventory",name:n("fields.managedInventory"),header:n("fields.managedInventory"),field:a=>`variants.${a.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:a=>e.jsx(A.BooleanCell,{context:a})}),K.column({id:"allow_backorder",name:n("fields.allowBackorder"),header:n("fields.allowBackorder"),field:a=>`variants.${a.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:a=>e.jsx(A.BooleanCell,{context:a})}),K.column({id:"inventory_kit",name:n("fields.inventoryKit"),header:n("fields.inventoryKit"),field:a=>`variants.${a.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:a=>e.jsx(A.BooleanCell,{context:a,disabled:!a.row.original.manage_inventory})}),...Qe({currencies:s,regions:r,pricePreferences:l,getFieldName:(a,u)=>{var h;return(h=a.column.id)!=null&&h.startsWith("currency_prices")?`variants.${a.row.original.originalIndex}.prices.${u}`:`variants.${a.row.original.originalIndex}.prices.${u}`},t:n})],[s,r,t,l,n])},xe="save-draft-button",qt=({defaultChannel:t,regions:s,store:r,pricePreferences:l})=>{const[n,a]=N.useState("details"),[u,h]=N.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:m}=E(),{handleSuccess:x}=ke(),{getFormConfigs:i}=le(),d=i("product","create"),v=rt({defaultValues:{...We,sales_channels:t?[{id:t.id,name:t.name}]:[]},schema:Ue,configs:d}),{mutateAsync:f,isPending:_}=at(),C=N.useMemo(()=>s!=null&&s.length?s.reduce((c,j)=>(c[j.id]=j.currency_code,c),{}):{},[s]),P=$({control:v.control,name:"variants"}),z=N.useMemo(()=>P.some(c=>c.manage_inventory&&c.inventory_kit),[P]),g=v.handleSubmit(async(c,j)=>{var k;let y=!1;(j==null?void 0:j.nativeEvent)instanceof SubmitEvent&&(y=((k=j==null?void 0:j.nativeEvent)==null?void 0:k.submitter).dataset.name===xe);const w=c.media||[],I={...c,media:void 0};let V=[];try{if(w.length){const S=w.find(T=>T.isThumbnail),b=w.filter(T=>!T.isThumbnail),M=[];S&&M.push(B.admin.upload.create({files:[S.file]}).then(T=>T.files.map(ee=>({...ee,isThumbnail:!0})))),b!=null&&b.length&&M.push(B.admin.upload.create({files:b.map(T=>T.file)}).then(T=>T.files.map(ee=>({...ee,isThumbnail:!1})))),V=(await Promise.all(M)).flat()}}catch(S){S instanceof Error&&te.error(S.message)}await f(Ge({...I,media:V,status:y?"draft":"published",regionsCurrencyMap:C}),{onSuccess:S=>{te.success(m("products.create.successToast",{title:S.product.title})),x(`../${S.product.id}`)},onError:S=>{te.error(S.message)}})}),p=async c=>{await v.trigger()&&(c==="details"&&a("organize"),c==="organize"&&a("variants"),c==="variants"&&a("inventory"))};return N.useEffect(()=>{const c={...u};n==="details"&&(c.details="in-progress"),n==="organize"&&(c.details="completed",c.organize="in-progress"),n==="variants"&&(c.details="completed",c.organize="completed",c.variants="in-progress"),n==="inventory"&&(c.details="completed",c.organize="completed",c.variants="completed",c.inventory="in-progress"),h({...c})},[n]),e.jsx(O.Form,{form:v,children:e.jsxs(pt,{onKeyDown:c=>{if(c.key==="Enter"){if(c.target instanceof HTMLTextAreaElement&&!(c.metaKey||c.ctrlKey))return;if(c.preventDefault(),c.metaKey||c.ctrlKey){if(n!=="variants"){c.preventDefault(),c.stopPropagation(),p(n);return}g()}}},onSubmit:g,className:"flex h-full flex-col",children:[e.jsxs(D,{value:n,onValueChange:async c=>{await v.trigger()&&a(c)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx(O.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(D.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(D.Trigger,{status:u.details,value:"details",className:"max-w-[200px] truncate",children:m("products.create.tabs.details")}),e.jsx(D.Trigger,{status:u.organize,value:"organize",className:"max-w-[200px] truncate",children:m("products.create.tabs.organize")}),e.jsx(D.Trigger,{status:u.variants,value:"variants",className:"max-w-[200px] truncate",children:m("products.create.tabs.variants")}),z&&e.jsx(D.Trigger,{status:u.inventory,value:"inventory",className:"max-w-[200px] truncate",children:m("products.create.tabs.inventory")})]})})}),e.jsxs(O.Body,{className:"size-full overflow-hidden",children:[e.jsx(D.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(Et,{form:v})}),e.jsx(D.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx(Ht,{form:v})}),e.jsx(D.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Kt,{form:v,store:r,regions:s,pricePreferences:l})}),z&&e.jsx(D.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(Ot,{form:v})})]})]}),e.jsx(O.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(O.Close,{asChild:!0,children:e.jsx(F,{variant:"secondary",size:"small",children:m("actions.cancel")})}),e.jsx(F,{"data-name":xe,size:"small",type:"submit",isLoading:_,className:"whitespace-nowrap",children:m("actions.saveAsDraft")}),e.jsx(Gt,{tab:n,next:p,isLoading:_,showInventoryTab:z})]})})]})})},Gt=({tab:t,next:s,isLoading:r,showInventoryTab:l})=>{const{t:n}=E();return t==="variants"&&!l||t==="inventory"&&l?e.jsx(F,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:r,children:n("actions.publish")},"submit-button"):e.jsx(F,{type:"button",variant:"primary",size:"small",onClick:()=>s(t),children:n("actions.continue")},"next-button")},As=()=>{const{t}=E(),{store:s,isPending:r,isError:l,error:n}=Je({fields:"+default_sales_channel"}),{sales_channel:a,isPending:u,isError:h,error:m}=et(s==null?void 0:s.default_sales_channel_id,{enabled:!!(s!=null&&s.default_sales_channel_id)}),{regions:x,isPending:i,isError:d,error:v}=tt({limit:9999}),{price_preferences:f,isPending:_,isError:C,error:P}=st({limit:9999}),z=!!s&&!r&&!!x&&!i&&!!a&&!u&&!!f&&!_;if(l)throw n;if(d)throw v;if(h)throw m;if(C)throw P;return e.jsxs(O,{children:[e.jsx(O.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.title")})}),e.jsx(O.Description,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.description")})}),z&&e.jsx(qt,{defaultChannel:a,store:s,pricePreferences:f,regions:x})]})};export{As as Component};
