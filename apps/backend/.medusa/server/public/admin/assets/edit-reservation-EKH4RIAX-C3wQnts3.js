import{K as F}from"./chunk-6HTZNHPT-VlvzTJFv.js";import{b as u,u as E}from"./chunk-4TC5YS65-DibKdFAA.js";import{a4 as I,b as w,fa as R,fb as T,eb as k,j as e,H as C,al as N,am as L,af as z,fc as M,t as b,w as s,I as V,B as _,as as A,ah as q,U as S}from"./index-BpfPnGdZ.js";import{S as x}from"./select-BWHoKjkd.js";import{T as B}from"./textarea-Dl-JCye7.js";import"./prompt-CpsPiMDa.js";import"./check-vtHah2d6.js";import"./triangles-mini-MGL63xRf.js";var D=z({location_id:q(),description:q().optional(),quantity:A().min(1)}),h=({title:t,value:r})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(S,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t}),e.jsx(S,{className:"px-2 py-1.5",size:"small",leading:"compact",children:r})]}),H=t=>({quantity:t.quantity,location_id:t.location_id,description:t.description??void 0}),K=({reservation:t,item:r,locations:l})=>{const{t:a}=w(),{handleSuccess:p}=E(),o=N({defaultValues:H(t),resolver:L(D)}),{mutateAsync:i}=M(t.id),j=o.handleSubmit(async n=>{i(n,{onSuccess:()=>{b.success(a("inventory.reservation.updateSuccessToast")),p()},onError:m=>{b.error(m.message)}})}),f=o.watch("quantity"),v=o.watch("location_id"),d=r.location_levels.find(n=>n.location_id===v);return e.jsx(u.Form,{form:o,children:e.jsxs(F,{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(u.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(s.Field,{control:o.control,name:"location_id",render:({field:{onChange:n,value:m,ref:y,...g}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("inventory.reservation.location")}),e.jsx(s.Control,{children:e.jsxs(x,{value:m,onValueChange:c=>{n(c)},...g,children:[e.jsx(x.Trigger,{ref:y,children:e.jsx(x.Value,{})}),e.jsx(x.Content,{children:(l||[]).map(c=>e.jsx(x.Item,{value:c.id,children:c.name},c.id))})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(h,{title:a("fields.title"),value:r.title??r.sku}),e.jsx(h,{title:a("fields.sku"),value:r.sku}),e.jsx(h,{title:a("fields.inStock"),value:d.stocked_quantity}),e.jsx(h,{title:a("inventory.available"),value:d.stocked_quantity-(d.reserved_quantity-t.quantity)-f})]}),e.jsx(s.Field,{control:o.control,name:"quantity",render:({field:{onChange:n,value:m,...y}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("inventory.reservation.reservedAmount")}),e.jsx(s.Control,{children:e.jsx(V,{type:"number",min:0,max:(d.available_quantity||0)+(t.quantity||0),value:m||"",onChange:g=>{const c=g.target.value;n(c===""?null:parseFloat(c))},...y})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:o.control,name:"description",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:a("fields.description")}),e.jsx(s.Control,{children:e.jsx(B,{...n})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(_,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(_,{type:"submit",size:"small",isLoading:!1,children:a("actions.save")})]})})]})})},X=()=>{var v;const{id:t}=I(),{t:r}=w(),{reservation:l,isPending:a,isError:p,error:o}=R(t),{inventory_item:i}=T(l==null?void 0:l.inventory_item_id,{enabled:!!l}),{stock_locations:j}=k({id:(v=i==null?void 0:i.location_levels)==null?void 0:v.map(d=>d.location_id)},{enabled:!!(i!=null&&i.location_levels)}),f=!a&&l&&i&&j;if(p)throw o;return e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx(C,{children:r("inventory.reservation.editItemDetails")})}),f&&e.jsx(K,{locations:j,reservation:l,item:i})]})};export{X as Component};
