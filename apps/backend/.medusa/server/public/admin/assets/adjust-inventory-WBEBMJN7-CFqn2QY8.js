import{c as h}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as I}from"./chunk-6HTZNHPT-VlvzTJFv.js";import{b as r,u as L}from"./chunk-4TC5YS65-DibKdFAA.js";import{a4 as w,b as q,fb as N,bv as S,j as e,H as F,af as T,ar as A,as as C,ah as E,aE as _,al as R,am as z,v as Q,fj as B,t as g,w as c,I as H,B as b,U as k}from"./index-BpfPnGdZ.js";import"./prompt-CpsPiMDa.js";var l=({title:a,value:t})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(k,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a}),e.jsx(k,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t})]}),P=({item:a,level:t,location:y})=>{const{t:s}=q(),{handleSuccess:x}=L(),v=T({stocked_quantity:A([C(),E()])}).superRefine((o,i)=>{const m=o.stocked_quantity?h(o.stocked_quantity):null;if(m===null){i.addIssue({code:_.invalid_type,expected:"number",received:"undefined",path:["stocked_quantity"]});return}m<t.reserved_quantity&&i.addIssue({code:_.custom,message:s("inventory.adjustInventory.errors.stockedQuantity",{quantity:t.reserved_quantity}),path:["stocked_quantity"]})}),n=R({defaultValues:{stocked_quantity:t.stocked_quantity},resolver:z(v)}),d=Q({control:n.control,name:"stocked_quantity"}),u=d?h(d)-t.reserved_quantity:0-t.reserved_quantity,{mutateAsync:j,isPending:p}=B(a.id,t.location_id),f=n.handleSubmit(async o=>{await j({stocked_quantity:h(o.stocked_quantity)},{onSuccess:()=>{g.success(s("inventory.toast.updateLevel")),x()},onError:i=>{g.error(i.message)}})});return e.jsx(r.Form,{form:n,children:e.jsxs(I,{onSubmit:f,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(r.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(l,{title:s("fields.title"),value:a.title??"-"}),e.jsx(l,{title:s("fields.sku"),value:a.sku}),e.jsx(l,{title:s("locations.domain"),value:y.name}),e.jsx(l,{title:s("inventory.reserved"),value:t.reserved_quantity}),e.jsx(l,{title:s("inventory.available"),value:u})]}),e.jsx(c.Field,{control:n.control,name:"stocked_quantity",render:({field:{onChange:o,value:i,...m}})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{children:s("fields.inStock")}),e.jsx(c.Control,{children:e.jsx(H,{type:"number",value:i,onChange:o,...m})}),e.jsx(c.ErrorMessage,{})]})})]}),e.jsx(r.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(r.Close,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(b,{type:"submit",size:"small",isLoading:p,children:s("actions.save")})]})})]})})},V=()=>{const{id:a,location_id:t}=w(),{t:y}=q(),{inventory_item:s,isPending:x,isError:v,error:n}=N(a),d=s==null?void 0:s.location_levels.find(f=>f.location_id===t),{stock_location:u,isLoading:j}=S(t),p=!x&&s&&d&&!j&&u;if(v)throw n;return e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx(F,{children:y("inventory.manageLocationQuantity")})}),p&&e.jsx(P,{item:s,level:d,location:u})]})};export{V as Component};
