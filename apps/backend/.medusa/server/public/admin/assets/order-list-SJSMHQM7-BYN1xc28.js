import{u as Z,a as De}from"./chunk-XMAWMECC-DjWCP7Yr.js";import{a as Ce,j as n,b as q,bc as K,bd as X,H as Te,be as Ne,ae as Fe,r as m,B as V,l as Ie,W as Re,k as ee,bf as D,bg as $e,bh as Le,a9 as te,bi as Ue,a7 as ke}from"./index-BpfPnGdZ.js";import{a as we}from"./chunk-OSOI7J6Y-BoQHjEVs.js";import{u as Ae,_ as ve}from"./chunk-7VJK6HNE-DDld2EhH.js";import"./lodash-t7RC0x8y.js";import"./chunk-Z26G6WFJ-DnGjRuyC.js";import{S as Pe}from"./chunk-2RQLKDBF-CaKeP8OW.js";import{u as Me,c as Je}from"./chunk-Q33G337Z-DuTP9Yqa.js";import{u as qe,a as ze,D as Be,S as He,c as Ge}from"./chunk-ONULGYMV-BQt2UhWy.js";import{u as We}from"./chunk-C76H5USB-Dd196HiU.js";import{R as Ye}from"./react-country-flag.esm-NdtiIxYy.js";import{u as Qe}from"./use-prompt-Cv7F2RTx.js";import{C as re}from"./container-CaN4_t7k.js";import{S as se}from"./status-badge-ohAqEdgy.js";import"./chunk-SJ3E4T6B-CIf0vQ8g.js";import"./chunk-P3UUX2T6-DAQ8YMMz.js";import"./chunk-PFKKVLZX-DLCEsDIG.js";import"./chunk-CB22IFJF-DW_8zTea.js";import"./chunk-7DXVXBSA-u0lQbI_F.js";import"./chunk-ADOCJB6L-KtCdTW2w.js";import"./chunk-Y2RYZS5B-DyMrZ3o1.js";import"./chunk-YEDAFXMB-DSZvk7zJ.js";import"./chunk-AOFGTNG6-CDM44hkC.js";import"./table-DW79ophy.js";import"./chunk-EMIHDNB7-SccrBMEV.js";import"./plus-mini-DwCGy8dy.js";import"./command-bar-CZwuJqwH.js";import"./_isIndex-CA4sJ4fU.js";import"./x-mark-mini-hOCHhWa9.js";import"./index-C0HLiVWt.js";import"./date-picker-BXzAAwZh.js";import"./popover-Dgs2umtn.js";import"./triangle-left-mini-CizkIkwI.js";import"./Trans-CBu9SpTd.js";import"./check-vtHah2d6.js";import"./checkbox-DCa7E6TW.js";import"./adjustments-CM1kR1Ir.js";import"./select-BWHoKjkd.js";import"./triangles-mini-MGL63xRf.js";import"./arrow-up-mini-ywWVFkNt.js";import"./pencil-square-B6or-DO4.js";import"./trash-CDEOtOav.js";import"./prompt-CpsPiMDa.js";var B=Je(),ie=()=>{const{t:e}=q(),r=Me(),{regions:t}=Ie({limit:1e3,fields:"id,name"}),{sales_channels:i}=Re({limit:1e3,fields:"id,name"});return m.useMemo(()=>{const s=[...r];return t!=null&&t.length&&s.push(B.accessor("region_id",{label:e("fields.region"),type:"multiselect",options:t.map(a=>({label:a.name,value:a.id}))})),i!=null&&i.length&&s.push(B.accessor("sales_channel_id",{label:e("fields.salesChannel"),type:"multiselect",options:i.map(a=>({label:a.name,value:a.id}))})),s},[t,i,r,e])},Ze=(e,r)=>r.split(".").reduce((t,i)=>t==null?void 0:t[i],e),$=(e,r="short")=>{const t=new Date(e);switch(r){case"short":return t.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});case"long":return t.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});case"relative":const s=new Date().getTime()-t.getTime(),a=Math.floor(s/(1e3*60*60*24));return a===0?"Today":a===1?"Yesterday":a<7?`${a} days ago`:t.toLocaleDateString("en-GB",{day:"numeric",month:"short"});default:return t.toLocaleDateString()}},Ke=({status:e})=>{const r=t=>{switch(t==null?void 0:t.toLowerCase()){case"paid":case"captured":return"green";case"pending":case"awaiting":return"orange";case"failed":case"canceled":return"red";default:return"grey"}};return n.jsx(se,{color:r(e),children:e})},Xe=({status:e})=>{const r=t=>{switch(t==null?void 0:t.toLowerCase()){case"fulfilled":case"shipped":return"green";case"partially_fulfilled":case"preparing":return"orange";case"canceled":case"returned":return"red";case"pending":case"not_fulfilled":return"grey";default:return"grey"}};return n.jsx(se,{color:r(e),children:e})},H=({status:e})=>n.jsx(te,{variant:"outline",className:"capitalize",children:e}),G={status:{payment:e=>n.jsx(Ke,{status:e}),fulfillment:e=>n.jsx(Xe,{status:e}),default:e=>n.jsx(H,{status:e})},currency:{default:(e,r)=>{if(e==null)return"-";const t=r.currency_code||"USD",i=we(e,t);return n.jsx("div",{className:"flex h-full w-full items-center justify-end text-right",children:n.jsx("span",{className:"truncate",children:i})})}},timestamp:{creation:e=>e?$(e,"short"):"-",update:e=>e?$(e,"relative"):"-",default:e=>e?$(e,"short"):"-"},identifier:{order:e=>`#${e}`,default:e=>e},email:{default:e=>e||"-"},enum:{default:e=>n.jsx(H,{status:e})},string:{default:e=>e||"-"},number:{default:e=>(e==null?void 0:e.toLocaleString())||"0"},boolean:{default:e=>n.jsx(te,{variant:e?"solid":"outline",children:e?"Yes":"No"})},object:{relationship:e=>!e||typeof e!="object"?"-":e.name?e.name:e.title?e.title:e.email?e.email:e.display_name?e.display_name:JSON.stringify(e),default:e=>!e||typeof e!="object"?"-":e.name?e.name:e.title?e.title:e.email?e.email:JSON.stringify(e)},date:{default:e=>e?$(e,"short"):"-"},datetime:{default:e=>e?$(e,"long"):"-"},computed:{display:e=>e||"-",default:e=>e||"-"}},Ve=e=>{const r=G[e.semantic_type];if(r){const s=r[e.context];if(s)return s;const a=r.default;if(a)return a}const t=e.data_type==="text"?"string":e.data_type,i=G[t];if(i){const s=i.default;if(s)return s}return s=>String(s||"-")},et={customer_name:e=>{var r,t,i,s;if((r=e.customer)!=null&&r.first_name||(t=e.customer)!=null&&t.last_name){const a=`${e.customer.first_name||""} ${e.customer.last_name||""}`.trim();if(a)return a}return(i=e.customer)!=null&&i.email?e.customer.email:(s=e.customer)!=null&&s.phone?e.customer.phone:"Guest"},address_summary:(e,r)=>{let t=null;if((r==null?void 0:r.field)==="shipping_address_display"?t=e.shipping_address:(r==null?void 0:r.field)==="billing_address_display"?t=e.billing_address:t=e.shipping_address||e.billing_address,!t)return"-";const i=[];t.address_1&&i.push(t.address_1);const s=[];return t.city&&s.push(t.city),t.province&&s.push(t.province),t.postal_code&&s.push(t.postal_code),s.length>0&&i.push(s.join(", ")),t.country_code&&i.push(t.country_code.toUpperCase()),i.join(" â€¢ ")||"-"},country_code:e=>{var s;const r=(s=e.shipping_address)==null?void 0:s.country_code;if(!r)return n.jsx("div",{className:"flex w-full justify-center",children:"-"});const t=Ue(r),i=(t==null?void 0:t.display_name)||r.toUpperCase();return n.jsx("div",{className:"flex w-full items-center justify-center",children:n.jsx(ke,{content:i,children:n.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:n.jsx(Ye,{countryCode:r.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":i})})})})}},tt={orders:{customer:{accessor:e=>{const r=e.shipping_address,t=e.customer;return r!=null&&r.first_name||r!=null&&r.last_name?`${r.first_name||""} ${r.last_name||""}`.trim():t!=null&&t.first_name||t!=null&&t.last_name?`${t.first_name||""} ${t.last_name||""}`.trim():(t==null?void 0:t.email)||"Guest"}}}},rt=(e,r,t)=>{if(t!=null&&t.computed){const s=et[t.computed.type];if(s)return a=>s(a,t)}const i=tt[e];if(i){const s=i[r];if(s!=null&&s.accessor)return s.accessor}return s=>Ze(s,r)};function st(e){return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")?"right":e.field==="country"||e.field.includes("country_code")?"center":"left"}var it=Ge();function nt(e){return m.useMemo(()=>e!=null&&e.length?e.map(r=>{const t=Ve(r),i=rt("orders",r.field,r),s=st(r);return it.accessor(i,{id:r.field,header:()=>r.name,cell:({getValue:a,row:c})=>{const j=a();return Le.isValidElement(j)?j:t(j,c.original)},meta:{name:r.name,column:r},enableHiding:r.hideable,enableSorting:!1,headerAlign:s})}):[],[e])}function at(e,r){const[t,i]=m.useState(()=>{if(e!=null&&e.length&&(r!=null&&r.configuration)){const o={};return e.forEach(f=>{var h;o[f.field]=((h=r.configuration.visible_columns)==null?void 0:h.includes(f.field))||!1}),o}else if(e!=null&&e.length)return k(e);return{}}),[s,a]=m.useState(()=>{var o;return(o=r==null?void 0:r.configuration)!=null&&o.column_order?r.configuration.column_order:e!=null&&e.length?w(e):[]}),c=m.useMemo(()=>({visibility:t,order:s}),[t,s]),j=m.useMemo(()=>({visible:Object.entries(t).filter(([f,h])=>h).map(([f])=>f),order:s}),[t,s]),b=m.useCallback(o=>{i(o)},[]),g=m.useCallback((o,f)=>{if(o!=null&&o.configuration){const h={};f.forEach(C=>{var T;h[C.field]=((T=o.configuration.visible_columns)==null?void 0:T.includes(C.field))||!1}),i(h),a(o.configuration.column_order||[])}else i(k(f)),a(w(f))},[]),u=m.useCallback(o=>{Object.keys(t).length===0&&i(k(o)),s.length===0&&a(w(o))},[]),y=m.useRef();return m.useEffect(()=>{var o,f,h;if(e!=null&&e.length){const C=((o=y.current)==null?void 0:o.id)!==(r==null?void 0:r.id),T=r&&((f=y.current)==null?void 0:f.id)===r.id&&y.current.updated_at!==r.updated_at;if(C||T)if(r!=null&&r.configuration){const F={};e.forEach(L=>{var U,I;F[L.field]=((I=(U=r.configuration)==null?void 0:U.visible_columns)==null?void 0:I.includes(L.field))||!1}),i(F),a(((h=r.configuration)==null?void 0:h.column_order)||[])}else i(k(e)),a(w(e))}y.current=r},[r,e]),{visibleColumns:t,columnOrder:s,columnState:c,currentColumns:j,setVisibleColumns:i,setColumnOrder:a,handleColumnVisibilityChange:b,handleViewChange:g,initializeColumns:u}}var W=500;function k(e){if(!e||e.length===0)return{};const r={};return e.forEach(t=>{r[t.field]=t.default_visible??!0}),r}function w(e){return!e||e.length===0?[]:[...e].sort((t,i)=>{const s=t.default_order??W,a=i.default_order??W;return s-a}).map(t=>t.field)}var ot=({isDefaultView:e,currentViewId:r,currentViewName:t,onSaveAsDefault:i,onUpdateExisting:s,onSaveAsNew:a})=>{const c=Qe(),j=async()=>{await c({title:"Update default view",description:"This will update the default view for all users. Are you sure?",confirmText:"Update for everyone",cancelText:"Cancel"})&&i()},b=async()=>{await c({title:"Update view",description:`Are you sure you want to update "${t}"?`,confirmText:"Update",cancelText:"Cancel"})&&s()};return n.jsxs(D,{children:[n.jsx(D.Trigger,{asChild:!0,children:n.jsxs(V,{variant:"secondary",size:"small",children:["Save",n.jsx($e,{})]})}),n.jsx(D.Content,{align:"end",children:e?n.jsxs(n.Fragment,{children:[n.jsx(D.Item,{onClick:j,children:"Update default for everyone"}),n.jsx(D.Item,{onClick:a,children:"Save as new view"})]}):n.jsxs(n.Fragment,{children:[n.jsxs(D.Item,{onClick:b,children:['Update "',t,'"']}),n.jsx(D.Item,{onClick:a,children:"Save as new view"})]})})]})},ne=["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],ae=["*customer","*sales_channel"],A=`${ne.join(",")},${ae.join(",")}`;function lt(e,r){if(!(e!=null&&e.length))return A;const t=e.filter(u=>Object.keys(r).length>0?r[u.field]===!0:u.default_visible),i=new Set;t.forEach(u=>{var y,o;u.computed?((y=u.computed.required_fields)==null||y.forEach(f=>i.add(f)),(o=u.computed.optional_fields)==null||o.forEach(f=>i.add(f))):(u.field.includes("."),i.add(u.field))});const s=Array.from(i),a=s.filter(u=>u.includes(".")),c=s.filter(u=>!u.includes(".")),j=a.filter(u=>{const[y]=u.split(".");return!ae.some(f=>f===`*${y}`||f===y)}),b=c.filter(u=>!ne.includes(u)),g=[...j,...b];return g.length>0?`${A},${g.join(",")}`:A}function dt(e,r){return m.useMemo(()=>lt(e,r),[e,r])}var Y=20,_="o";function Q(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}var ct=()=>{const{t:e}=q(),r=K("view_configurations"),{activeView:t,createView:i}=qe("orders"),s=(t==null?void 0:t.view_configuration)||null,{updateView:a}=ze("orders",(s==null?void 0:s.id)||""),{columns:c,isLoading:j}=Ne("orders",{enabled:r}),b=ie(),g=We(["q","order",...b.map(d=>d.id)],_),[u,y]=Fe(),{visibleColumns:o,columnOrder:f,currentColumns:h,setColumnOrder:C,handleColumnVisibilityChange:T,handleViewChange:F}=at(c,s);m.useEffect(()=>{c&&(F(s,c),y(d=>{if(Array.from(d.keys()).filter(l=>l.startsWith(_+"_")||l===_+"_q"||l===_+"_order").forEach(l=>d.delete(l)),s){const l=s.configuration;if(l.filters&&Object.entries(l.filters).forEach(([O,p])=>{d.set(`${_}_${O}`,JSON.stringify(p))}),l.sorting){const O=l.sorting.desc?`-${l.sorting.id}`:l.sorting.id;d.set(`${_}_order`,O)}l.search&&d.set(`${_}_q`,l.search)}return d}))},[s,c]);const[L,U]=m.useState(!1),I=m.useMemo(()=>{const d={};b.forEach(p=>{g[p.id]!==void 0&&(d[p.id]=JSON.parse(g[p.id]||""))});const E=g.order?Q(g.order):null,l=g.q||"",O=Object.entries(o).filter(([p,N])=>N).map(([p])=>p).sort();if(s){const p=s.configuration.filters||{},N=s.configuration.sorting,M=s.configuration.search||"",S=[...s.configuration.visible_columns||[]].sort(),R=s.configuration.column_order||[],xe=new Set([...Object.keys(d),...Object.keys(p)]);for(const z of xe)if(JSON.stringify(d[z])!==JSON.stringify(p[z]))return!0;const Oe=E||void 0,Ee=N||void 0;if(JSON.stringify(Oe)!==JSON.stringify(Ee)||l!==M||JSON.stringify(O)!==JSON.stringify(S)||JSON.stringify(f)!==JSON.stringify(R))return!0}else{if(Object.keys(d).length>0||E!==null||l!=="")return!0;if(c){const p=new Set(Object.entries(o).filter(([S,R])=>R).map(([S])=>S)),N=new Set(c.filter(S=>S.default_visible).map(S=>S.field));if(p.size!==N.size||[...p].some(S=>!N.has(S)))return!0;const M=c.sort((S,R)=>(S.default_order??500)-(R.default_order??500)).map(S=>S.field);if(JSON.stringify(f)!==JSON.stringify(M))return!0}}return!1},[s,o,f,b,g,c]);m.useEffect(()=>{const d=setTimeout(()=>{U(I)},50);return()=>clearTimeout(d)},[I]);const oe=m.useCallback(()=>{c&&F(s,c),y(d=>{if(Array.from(d.keys()).filter(l=>l.startsWith(_+"_")||l===_+"_q"||l===_+"_order").forEach(l=>d.delete(l)),s!=null&&s.configuration){const l=s.configuration;if(l.filters&&Object.entries(l.filters).forEach(([O,p])=>{d.set(`${_}_${O}`,JSON.stringify(p))}),l.sorting){const O=l.sorting.desc?`-${l.sorting.id}`:l.sorting.id;d.set(`${_}_order`,O)}l.search&&d.set(`${_}_q`,l.search)}return d})},[s,c]),x=m.useMemo(()=>{const d={};return b.forEach(E=>{g[E.id]!==void 0&&(d[E.id]=JSON.parse(g[E.id]||""))}),{filters:d,sorting:g.order?Q(g.order):null,search:g.q||""}},[b,g]),[le,v]=m.useState(!1),[de,P]=m.useState(null),ce=async()=>{try{s!=null&&s.is_system_default?await a.mutateAsync({name:s.name||null,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}}):await i.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}})}catch{}},fe=async()=>{if(s)try{await a.mutateAsync({name:s.name,configuration:{visible_columns:h.visible,column_order:h.order,filters:x.filters||{},sorting:x.sorting||null,search:x.search||""}})}catch{}},ue=()=>{v(!0),P(null)},ge=dt(c,o),me=L?n.jsxs(n.Fragment,{children:[n.jsx(V,{variant:"secondary",size:"small",type:"button",onClick:oe,children:e("actions.clear")}),n.jsx(ot,{isDefaultView:(s==null?void 0:s.is_system_default)||!s,currentViewId:s==null?void 0:s.id,currentViewName:s==null?void 0:s.name,onSaveAsDefault:ce,onUpdateExisting:fe,onSaveAsNew:ue})]}):null,{searchParams:he}=Z({pageSize:Y,prefix:_}),{orders:ye,count:pe,isError:_e,error:be,isLoading:Se}=X({fields:ge,...he},{placeholderData:ee}),je=nt(c);if(_e)throw be;return n.jsxs(re,{className:"divide-y p-0",children:[n.jsx(Be,{data:ye??[],columns:je,filters:b,getRowId:d=>d.id,rowCount:pe,enablePagination:!0,enableSearch:!0,pageSize:Y,isLoading:Se||j,layout:"fill",heading:e("orders.domain"),enableColumnVisibility:r,initialColumnVisibility:o,onColumnVisibilityChange:T,columnOrder:f,onColumnOrderChange:C,enableViewSelector:r,entity:"orders",currentColumns:h,filterBarContent:me,rowHref:d=>`/orders/${d.id}`,emptyState:{empty:{heading:e("orders.list.noRecordsMessage")}},prefix:_}),le&&n.jsx(He,{entity:"orders",currentColumns:h,currentConfiguration:x,editingView:de,onClose:()=>{v(!1),P(null)},onSaved:()=>{v(!1),P(null)}})]})},J=20,ft=()=>{const{t:e}=q();if(K("view_configurations"))return n.jsx(ct,{});const{searchParams:t,raw:i}=Z({pageSize:J}),{orders:s,count:a,isError:c,error:j,isLoading:b}=X({fields:A,...t},{placeholderData:ee}),g=ie(),u=De({}),{table:y}=Ae({data:s??[],columns:u,enablePagination:!0,count:a,pageSize:J});if(c)throw j;return n.jsxs(re,{className:"divide-y p-0",children:[n.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:n.jsx(Te,{children:e("orders.domain")})}),n.jsx(ve,{columns:u,table:y,pagination:!0,navigateTo:o=>`/orders/${o.original.id}`,filters:g,count:a,search:!0,isLoading:b,pageSize:J,orderBy:[{key:"display_id",label:e("orders.fields.displayId")},{key:"created_at",label:e("fields.createdAt")},{key:"updated_at",label:e("fields.updatedAt")}],queryObject:i,noRecords:{message:e("orders.list.noRecordsMessage")}})]})},tr=()=>{const{getWidgets:e}=Ce();return n.jsx(Pe,{widgets:{after:e("order.list.after"),before:e("order.list.before")},hasOutlet:!1,children:n.jsx(ft,{})})};export{tr as Component};
