import{I as B}from"./chunk-Q5DI5VYN-BL4OUuVi.js";import{a as f,T as m}from"./chunk-MSDRGCRR-DOUUuCWL.js";import{P as c}from"./chunk-P3UUX2T6-DAQ8YMMz.js";import{u as K,_ as $}from"./chunk-7VJK6HNE-DDld2EhH.js";import{a4 as F,d as G,fb as D,a as J,j as e,a5 as V,s as E,e6 as w,q as j,b as u,H as y,B as z,L as I,aT as W,az as Y,A as R,ff as Z,bq as X,eb as U,r as T,u as ee,f as te,fg as se,t as S,a7 as ie,f8 as re}from"./index-BpfPnGdZ.js";import"./lodash-t7RC0x8y.js";import"./chunk-Z26G6WFJ-DnGjRuyC.js";import{g as ae}from"./chunk-B6ZOPCPA-COFsw84B.js";import{S as l}from"./chunk-LFLGEXIG-38RNoi5w.js";import{T as _}from"./chunk-2RQLKDBF-CaKeP8OW.js";import{D as ne,c as oe}from"./chunk-ONULGYMV-BQt2UhWy.js";import{u as Q}from"./chunk-C76H5USB-Dd196HiU.js";import{u as le}from"./chunk-PFKKVLZX-DLCEsDIG.js";import{P as q}from"./pencil-square-B6or-DO4.js";import{u as A}from"./use-prompt-Cv7F2RTx.js";import{T as M}from"./trash-CDEOtOav.js";import{C as g}from"./container-CaN4_t7k.js";import"./chunk-YEDAFXMB-DSZvk7zJ.js";import"./chunk-AOFGTNG6-CDM44hkC.js";import"./table-DW79ophy.js";import"./chunk-EMIHDNB7-SccrBMEV.js";import"./plus-mini-DwCGy8dy.js";import"./command-bar-CZwuJqwH.js";import"./_isIndex-CA4sJ4fU.js";import"./x-mark-mini-hOCHhWa9.js";import"./index-C0HLiVWt.js";import"./date-picker-BXzAAwZh.js";import"./popover-Dgs2umtn.js";import"./triangle-left-mini-CizkIkwI.js";import"./Trans-CBu9SpTd.js";import"./check-vtHah2d6.js";import"./checkbox-DCa7E6TW.js";import"./adjustments-CM1kR1Ir.js";import"./select-BWHoKjkd.js";import"./triangles-mini-MGL63xRf.js";import"./arrow-up-mini-ywWVFkNt.js";import"./prompt-CpsPiMDa.js";var C="*variants,*variants.product,*variants.options",at=t=>{const{id:s}=t.params||{},{inventory_item:i}=D(s,{fields:C},{initialData:t.data,enabled:!!s});return i?e.jsx("span",{children:i.title??i.sku??s}):null},ce=({inventoryItem:t})=>{const{t:s}=u();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.attributes")}),e.jsx(R,{groups:[{actions:[{label:s("actions.edit"),to:"attributes",icon:e.jsx(q,{})}]}]})]}),e.jsx(l,{title:s("fields.height"),value:t.height}),e.jsx(l,{title:s("fields.width"),value:t.width}),e.jsx(l,{title:s("fields.length"),value:t.length}),e.jsx(l,{title:s("fields.weight"),value:t.weight}),e.jsx(l,{title:s("fields.midCode"),value:t.mid_code}),e.jsx(l,{title:s("fields.material"),value:t.material}),e.jsx(l,{title:s("fields.hsCode"),value:t.hs_code}),e.jsx(l,{title:s("fields.countryOfOrigin"),value:ae(t.origin_country)})]})},p=oe(),de=()=>{const{t}=u(),s=ee(),i=A(),a=async r=>{if(await i({title:t("general.areYouSure"),description:t("inventory.deleteWarning"),confirmText:t("actions.delete"),cancelText:t("actions.cancel")}))try{await E.admin.inventoryItem.deleteLevel(r.inventory_item_id,r.location_id),j.invalidateQueries({queryKey:w.lists()}),j.invalidateQueries({queryKey:w.detail(r.inventory_item_id)}),j.invalidateQueries({queryKey:se.detail(r.inventory_item_id)})}catch(o){S.error(o.message)}};return T.useMemo(()=>[p.accessor("stock_locations.0.name",{header:t("fields.location"),cell:({getValue:r})=>{const n=r();return n?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n.toString()})}):e.jsx(c,{})}}),p.accessor("reserved_quantity",{header:t("inventory.reserved"),cell:({getValue:r})=>{const n=r();return Number.isNaN(n)?e.jsx(c,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n})})},enableSorting:!0}),p.accessor("stocked_quantity",{header:t("fields.inStock"),cell:({getValue:r})=>{const n=r();return Number.isNaN(n)?e.jsx(c,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n})})},enableSorting:!0}),p.accessor("available_quantity",{header:t("inventory.available"),cell:({getValue:r})=>{const n=r();return Number.isNaN(n)?e.jsx(c,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n})})}}),p.action({actions:r=>{const n=r.row.original;return[[{icon:e.jsx(q,{}),label:t("actions.edit"),onClick:o=>{s(`locations/${n.location_id}`)}}],[{icon:e.jsx(M,{}),label:t("actions.delete"),onClick:()=>a(n),disabled:n.reserved_quantity>0||n.stocked_quantity>0}]]}})],[t])},ue=({pageSize:t=20,prefix:s})=>{const i=Q(["order","offset","location_id","stocked_quantity","reserved_quantity","incoming_quantity"],s),{offset:a,...r}=i;return{limit:t,offset:a?Number(a):0,...r}},k=20,P="invlvl",me=({inventory_item_id:t})=>{const s=ue({pageSize:k,prefix:P}),{inventory_levels:i,count:a,isPending:r,isError:n,error:o}=Z(t,{...s,fields:"+stock_locations.id,+stock_locations.name"}),b=de();if(n)throw o;return e.jsx(ne,{data:i??[],columns:b,rowCount:a,pageSize:k,getRowId:h=>h.id,isLoading:r,prefix:P,layout:"fill",enableSearch:!1})},xe=({inventoryItem:t})=>{const{t:s}=u();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{children:s("inventory.locationLevels")}),e.jsx(z,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(I,{to:"locations",children:s("inventory.manageLocations")})})]}),e.jsx(me,{inventory_item_id:t.id})]})},ve=({date:t})=>{const{getFullDate:s}=le();return t?e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx(ie,{className:"z-10",content:e.jsx("span",{className:"text-pretty",children:`${s({date:t,includeTime:!0})}`}),children:e.jsx("span",{className:"truncate",children:s({date:t,includeTime:!0})})})}):e.jsx(c,{})},fe=({reservation:t})=>{const{t:s}=u(),i=A(),{mutateAsync:a}=re(t.id),r=async()=>{await i({title:s("general.areYouSure"),description:s("inventory.deleteWarning"),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await a(void 0,{onSuccess:()=>{S.success(s("inventory.reservation.deleteSuccessToast"))},onError:o=>{S.error(o.message)}})};return e.jsx(R,{groups:[{actions:[{icon:e.jsx(q,{}),label:s("actions.edit"),to:`/reservations/${t.id}/edit`}]},{actions:[{icon:e.jsx(M,{}),label:s("actions.delete"),onClick:r}]}]})},d=te(),pe=({sku:t})=>{const{t:s}=u();return T.useMemo(()=>[d.display({id:"sku",header:()=>e.jsx(m,{text:s("fields.sku")}),cell:()=>e.jsx(f,{text:t})}),d.accessor("line_item.order_id",{header:()=>e.jsx(m,{text:s("inventory.reservation.orderID")}),cell:({getValue:i})=>{const a=i();return a?e.jsx(f,{text:a}):e.jsx(c,{})}}),d.accessor("description",{header:()=>e.jsx(m,{text:s("fields.description")}),cell:({getValue:i})=>{const a=i();return a?e.jsx(f,{text:a}):e.jsx(c,{})}}),d.accessor("location.name",{header:()=>e.jsx(m,{text:s("inventory.reservation.location")}),cell:({getValue:i})=>{const a=i();return a?e.jsx(f,{text:a}):e.jsx(c,{})}}),d.accessor("created_at",{header:()=>e.jsx(m,{text:s("fields.createdAt")}),cell:({getValue:i})=>e.jsx(ve,{date:i()})}),d.accessor("quantity",{header:()=>e.jsx(m,{text:s("fields.quantity"),align:"right"}),cell:({getValue:i})=>e.jsx(f,{text:i(),align:"right"})}),d.display({id:"actions",cell:({row:i})=>e.jsx(fe,{reservation:i.original})})],[s])},he=({pageSize:t=20,prefix:s})=>{const i=Q(["id","location_id","inventory_item_id","quantity","line_item_id","description","created_by"],s),{quantity:a,...r}=i;return{searchParams:{limit:t,quantity:a?JSON.parse(a):void 0,...r},raw:i}},N=20,je=({inventoryItem:t})=>{const{searchParams:s,raw:i}=he({pageSize:N}),{reservations:a,count:r,isPending:n,isError:o,error:b}=X({...s,inventory_item_id:[t.id]}),{stock_locations:h}=U({id:(a||[]).map(x=>x.location_id)}),O=T.useMemo(()=>{const x=new Map((h||[]).map(v=>[v.id,v]));return(a||[]).map(v=>({...v,location:x.get(v.location_id)}))},[a,h]),L=pe({sku:t.sku}),{table:H}=K({data:O??[],columns:L,count:r,enablePagination:!0,getRowId:x=>x.id,pageSize:N});if(o)throw b;return e.jsx($,{table:H,columns:L,pageSize:N,count:r,isLoading:n,pagination:!0,queryObject:i})},ye=({inventoryItem:t})=>{const{t:s}=u();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{children:s("reservations.domain")}),e.jsx(z,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(I,{to:`/reservations/create?item_id=${t.id}`,children:s("actions.create")})})]}),e.jsx(je,{inventoryItem:t})]})},ge=({variants:t})=>{const{t:s}=u();return t!=null&&t.length?e.jsxs(g,{className:"p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(y,{level:"h2",children:s("inventory.associatedVariants")})}),e.jsx("div",{className:"txt-small flex flex-col gap-2 px-2 pb-2",children:t.map(i=>{var n;const a=i.product?`/products/${i.product.id}/variants/${i.id}`:null,r=e.jsx("div",{className:"shadow-elevation-card-rest bg-ui-bg-component rounded-md px-4 py-2 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"shadow-elevation-card-rest rounded-md",children:e.jsx(W,{src:(n=i.product)==null?void 0:n.thumbnail})}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("span",{className:"text-ui-fg-base font-medium",children:i.title}),e.jsx("span",{className:"text-ui-fg-subtle",children:i.options.map(o=>o.value).join(" â‹… ")})]}),e.jsx("div",{className:"size-7 flex items-center justify-center",children:e.jsx(Y,{className:"text-ui-fg-muted"})})]})});return a?e.jsx(I,{to:a,className:"outline-none focus-within:shadow-borders-interactive-with-focus rounded-md [&:hover>div]:bg-ui-bg-component-hover",children:r},i.id):e.jsx("div",{children:r},i.id)})})]}):null},nt=()=>{const{id:t}=F(),s=G(),{inventory_item:i,isPending:a,isError:r,error:n}=D(t,{fields:C},{initialData:s}),{getWidgets:o}=J();if(a||!i)return e.jsx(V,{showJSON:!0,mainSections:3,sidebarSections:2,showMetadata:!0});if(r)throw n;return e.jsxs(_,{widgets:{after:o("inventory_item.details.after"),before:o("inventory_item.details.before"),sideAfter:o("inventory_item.details.side.after"),sideBefore:o("inventory_item.details.side.before")},data:i,showJSON:!0,showMetadata:!0,children:[e.jsxs(_.Main,{children:[e.jsx(B,{inventoryItem:i}),e.jsx(xe,{inventoryItem:i}),e.jsx(ye,{inventoryItem:i})]}),e.jsxs(_.Sidebar,{children:[e.jsx(ge,{variants:i.variants}),e.jsx(ce,{inventoryItem:i})]})]})},be=t=>({queryKey:w.detail(t),queryFn:async()=>E.admin.inventoryItem.retrieve(t,{fields:C})}),ot=async({params:t})=>{const s=t.id,i=be(s);return j.ensureQueryData(i)};export{at as Breadcrumb,nt as Component,ot as loader};
