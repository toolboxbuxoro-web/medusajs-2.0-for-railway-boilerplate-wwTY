import{D as je}from"./chunk-KEQOAJC2-BSP0czvj.js";import{A as be}from"./chunk-INJUODER-CRBY3kih.js";import{R as A}from"./chunk-R2NWOCML-B2QNVPAM.js";import{D as ce,C as ve}from"./chunk-WDXBQYSF-CZ9O4dAd.js";import{c as Ce,g as Ne}from"./chunk-Y2RYZS5B-DyMrZ3o1.js";import{j as e,r as F,b as Fe,al as we,am as Se,af as O,en as Te,t as L,v as g,eo as Re,w as a,H as De,a9 as Ve,M as p,I as de,U as P,D as y,ao as qe,B as k,ag as U,aq as me,ai as _,ah as m,as as K,ar as Ie}from"./index-BpfPnGdZ.js";import"./chunk-2PMSBTXI-BdzS7q8P.js";import{K as Be}from"./chunk-6HTZNHPT-VlvzTJFv.js";import{R as j,u as Ee}from"./chunk-4TC5YS65-DibKdFAA.js";import{T as z}from"./Trans-CBu9SpTd.js";import{P as h}from"./progress-tabs-xhh61ah2.js";import{R as c}from"./radio-group-B9dCMRTd.js";import{A as Me}from"./alert-N-NMZIr-.js";import{C as Ae}from"./currency-input-CROLy3x9.js";import"./chunk-VLXWP5KL-vTWCgfHQ.js";import"./textarea-Dl-JCye7.js";import"./date-picker-BXzAAwZh.js";import"./popover-Dgs2umtn.js";import"./x-mark-mini-hOCHhWa9.js";import"./triangle-left-mini-CizkIkwI.js";import"./select-BWHoKjkd.js";import"./check-vtHah2d6.js";import"./triangles-mini-MGL63xRf.js";import"./chunk-HFB3OQXI-D-mb50b6.js";import"./chunk-F6ZOHZVB-C1zk3qa4.js";import"./plus-mini-DwCGy8dy.js";import"./prompt-CpsPiMDa.js";import"./index-C0HLiVWt.js";var H=me(O({id:m().optional(),attribute:m().min(1,{message:"Required field"}),operator:m().min(1,{message:"Required field"}),values:Ie([K().min(1,{message:"Required field"}),m().min(1,{message:"Required field"}),me(m()).min(1,{message:"Required field"})]),required:U().optional(),disguised:U().optional(),field_type:m().optional()})),Le=O({template_id:m().optional(),campaign_id:m().optional(),campaign_choice:_(["none","existing","new"]).optional(),is_automatic:m().toLowerCase(),code:m().min(1),type:_(["buyget","standard"]),status:_(["draft","active","inactive"]),rules:H,is_tax_inclusive:U().optional(),application_method:O({allocation:_(["each","across"]),value:K().min(0).or(m().min(1)),currency_code:m().optional(),max_quantity:K().optional().nullable(),target_rules:H,buy_rules:H,type:_(["fixed","percentage"]),target_type:_(["order","shipping_methods","items"])}),campaign:ve.optional()}).refine(f=>f.application_method.allocation==="across"?!0:f.application_method.allocation==="each"&&typeof f.application_method.max_quantity=="number",{path:["application_method.max_quantity"],message:"required field"}),b=["type","application_method.type","application_method.allocation"],Pe=[...b],ke=[...b],ze=[...b,"is_tax_inclusive"],He=[...b,"is_tax_inclusive"],Oe=[...b,"application_method.value","is_tax_inclusive"],Ue=[...b,"application_method.value","is_tax_inclusive"],G=[{id:"amount_off_products",type:"standard",title:"Amount off products",description:"Discount specific products or collection of products",hiddenFields:ke,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"fixed"}}},{id:"amount_off_order",type:"standard",title:"Amount off order",description:"Discounts the total order amount",hiddenFields:Pe,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"fixed"}}},{id:"percentage_off_product",type:"standard",title:"Percentage off product",description:"Discounts a percentage off selected products",hiddenFields:He,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"percentage"}}},{id:"percentage_off_order",type:"standard",title:"Percentage off order",description:"Discounts a percentage of the total order amount",hiddenFields:ze,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"percentage"}}},{id:"buy_get",type:"buy_get",title:"Buy X Get Y",description:"Buy X product(s), get Y product(s)",hiddenFields:Oe,defaults:{is_automatic:"false",type:"buyget",application_method:{type:"percentage",value:100,apply_to_quantity:1,max_quantity:1}}},{id:"shipping_discount",type:"standard",title:"Free shipping",description:"Applies a 100% discount to shipping fees",hiddenFields:Ue,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"shipping_methods",type:"percentage",value:100}}}],pe={campaign_id:void 0,template_id:G[0].id,campaign_choice:"none",is_automatic:"false",code:"",type:"standard",status:"draft",rules:[],is_tax_inclusive:!1,application_method:{allocation:"each",type:"fixed",target_type:"items",max_quantity:1,target_rules:[],buy_rules:[]},campaign:void 0},Ke=()=>{var ee,te,ae,oe,se;const[f,w]=F.useState("type"),[R,S]=F.useState({type:"in-progress",promotion:"not-started",campaign:"not-started"}),{t:o}=Fe(),{handleSuccess:ue}=Ee(),s=we({defaultValues:pe,resolver:Se(Le)}),{setValue:u,reset:$,getValues:X}=s,{mutateAsync:xe}=Te(),he=s.handleSubmit(async t=>{const{campaign_choice:i,is_automatic:n,is_tax_inclusive:d,template_id:x,application_method:v,rules:E,...C}=t,{target_rules:ie=[],buy_rules:re=[],...ne}=v,_e=[...ie.filter(l=>!!l.disguised),...re.filter(l=>!!l.disguised),...E.filter(l=>!!l.disguised)],le={};for(const l of _e)le[l.attribute]=l.field_type==="number"?parseInt(l.values):l.values;const M=l=>l.filter(N=>!N.disguised).map(N=>({operator:N.operator,attribute:N.attribute,values:N.values}));xe({...C,rules:M(E),application_method:{...ne,...le,value:parseFloat(ne.value),target_rules:M(ie),buy_rules:M(re)},is_tax_inclusive:d,is_automatic:n==="true"},{onSuccess:({promotion:l})=>{L.success(o("promotions.toasts.promotionCreateSuccess",{code:l.code})),ue(`/promotions/${l.id}`)},onError:l=>{L.error(l.message)}})},async t=>{const{campaign:i,...n}=t||{};!!Object.keys(n||{}).length&&L.error(o("promotions.errors.promotionTabError"))}),D=async t=>{switch(t){case"type":S(i=>({...i,type:"in-progress"})),w(t);break;case"promotion":S(i=>({...i,type:"completed",promotion:"in-progress"})),w(t);break;case"campaign":{if(!await s.trigger()){S({type:"completed",promotion:"in-progress",campaign:"not-started"}),w("promotion");break}S(n=>({...n,promotion:"completed",campaign:"in-progress"})),w(t);break}}},fe=async()=>{switch(f){case"type":D("promotion");break;case"promotion":{await s.trigger()&&D("campaign");break}}},V=g({control:s.control,name:"template_id"}),r=F.useMemo(()=>{const t=G.find(i=>i.id===V);if(t){$({...pe,template_id:V});for(const[i,n]of Object.entries(t.defaults))if(typeof n=="object")for(const[d,x]of Object.entries(n))u(`application_method.${d}`,x);else u(i,n);return t}},[V,u,$]),q=g({control:s.control,name:"application_method.type"})==="fixed",I=g({control:s.control,name:"application_method.allocation"});F.useEffect(()=>{I==="across"&&u("application_method.max_quantity",null)},[I,u]);const Y=g({control:s.control,name:"type"}),B=Y==="standard",Q=Y==="buyget",ge=g({control:s.control,name:"application_method.target_type"})==="order",W=s.getValues();let J={};W.application_method.currency_code&&(J={budget:{currency_code:W.application_method.currency_code}});const{campaigns:ye}=Re(J),T=g({control:s.control,name:"campaign_choice"});F.useEffect(()=>{var i,n;const t=X();T!=="existing"&&u("campaign_id",void 0),T!=="new"&&u("campaign",void 0),T==="new"&&(!t.campaign||!((n=(i=t.campaign)==null?void 0:i.budget)!=null&&n.type))&&u("campaign",{...ce,budget:{...ce.budget,currency_code:t.application_method.currency_code}})},[T,X,u]);const Z=g({control:s.control,name:"rules"}).find(t=>t.attribute==="currency_code");if(Z){const i=s.getValues().application_method.currency_code,n=Z.values;!Array.isArray(n)&&i!==n&&s.setValue("application_method.currency_code",n)}return e.jsx(j.Form,{form:s,children:e.jsxs(Be,{className:"flex h-full flex-col",onSubmit:he,children:[e.jsxs(h,{value:f,onValueChange:t=>D(t),className:"flex h-full flex-col overflow-hidden",children:[e.jsx(j.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(h.List,{className:"grid w-full grid-cols-3",children:[e.jsx(h.Trigger,{className:"w-full",value:"type",status:R.type,children:o("promotions.tabs.template")}),e.jsx(h.Trigger,{className:"w-full",value:"promotion",status:R.promotion,children:o("promotions.tabs.details")}),e.jsx(h.Trigger,{className:"w-full",value:"campaign",status:R.campaign,children:o("promotions.tabs.campaign")})]})})})}),e.jsxs(j.Body,{className:"size-full overflow-hidden",children:[e.jsx(h.Content,{value:"type",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"w-full max-w-[720px] py-16",children:e.jsx(a.Field,{control:s.control,name:"template_id",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsx(c,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:G.map(i=>e.jsx(c.ChoiceBox,{value:i.id,label:i.title,description:i.description},i.id))},"template_id")}),e.jsx(a.ErrorMessage,{})]})})})})}),e.jsx(h.Content,{value:"promotion",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:[e.jsxs(De,{level:"h1",className:"text-fg-base",children:[o("promotions.sections.details"),(r==null?void 0:r.title)&&e.jsx(Ve,{className:"ml-2 align-middle",color:"grey",size:"2xsmall",rounded:"full",children:r==null?void 0:r.title})]}),s.formState.errors.root&&e.jsx(Me,{variant:"error",dismissible:!1,className:"text-balance",children:s.formState.errors.root.message}),e.jsx(a.Field,{control:s.control,name:"is_automatic",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.method.label")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:s.control,name:"status",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.status.label")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(a.Field,{control:s.control,name:"code",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.code.title")}),e.jsx(a.Control,{children:e.jsx(de,{...t,placeholder:"SUMMER15"})}),e.jsx(P,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(z,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]})})}),!((ee=r==null?void 0:r.hiddenFields)!=null&&ee.includes("is_tax_inclusive"))&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx("div",{className:"flex gap-x-2 gap-y-4",children:e.jsx(a.Field,{control:s.control,name:"is_tax_inclusive",render:({field:{onChange:t,value:i,...n}})=>e.jsxs(a.Item,{className:"basis-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"block",children:[e.jsx(a.Label,{children:o("promotions.form.taxInclusive.title")}),e.jsx(a.Hint,{className:"!mt-1",children:o("promotions.form.taxInclusive.description")})]}),e.jsx(a.Control,{className:"mr-2 self-center",children:e.jsx(qe,{className:"mt-[2px]",checked:!!i,onCheckedChange:t,...n})})]}),e.jsx(a.ErrorMessage,{})]})})})]}),!((te=r==null?void 0:r.hiddenFields)!=null&&te.includes("type"))&&e.jsx(a.Field,{control:s.control,name:"type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"standard",label:o("promotions.form.type.standard.title"),description:o("promotions.form.type.standard.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"buyget",label:o("promotions.form.type.buyget.title"),description:o("promotions.form.type.buyget.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(y,{}),e.jsx(A,{form:s,ruleType:"rules"}),!((ae=r==null?void 0:r.hiddenFields)!=null&&ae.includes("application_method.type"))&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(a.Field,{control:s.control,name:"application_method.type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.value_type")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})})]}),!((oe=r==null?void 0:r.hiddenFields)!=null&&oe.includes("application_method.value"))&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(a.Field,{control:s.control,name:"application_method.value",render:({field:{onChange:t,value:i,...n}})=>{const d=s.getValues().application_method.currency_code,x=Ce[(d==null?void 0:d.toUpperCase())||"USD"];return e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{tooltip:d||!q?void 0:o("promotions.fields.amount.tooltip"),children:o("promotions.form.value.title")}),e.jsx(a.Control,{children:q?e.jsx(Ae,{...n,min:0,code:d||"USD",onValueChange:(v,E,C)=>t(C==null?void 0:C.value),decimalScale:(x==null?void 0:x.decimal_digits)??2,decimalsLimit:(x==null?void 0:x.decimal_digits)??2,symbol:d?Ne(d):"$",value:i,disabled:!d}):e.jsx(je,{className:"text-right",min:0,max:100,...n,value:i,onChange:v=>{t(v.target.value===""?null:parseFloat(v.target.value))}},"amount")}),e.jsx(P,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(z,{t:o,i18nKey:q?"promotions.form.value_type.fixed.description":"promotions.form.value_type.percentage.description",components:[e.jsx("br",{},"break")]})}),e.jsx(a.ErrorMessage,{})]})}})]}),(B&&I==="each"||Q)&&e.jsxs(e.Fragment,{children:[Q&&e.jsx(e.Fragment,{children:e.jsx(y,{})}),e.jsx(a.Field,{control:s.control,name:"application_method.max_quantity",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.max_quantity.title")}),e.jsx(a.Control,{children:e.jsx(de,{...s.register("application_method.max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(P,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(z,{t:o,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})})]})})]}),B&&!((se=r==null?void 0:r.hiddenFields)!=null&&se.includes("application_method.allocation"))&&e.jsx(a.Field,{control:s.control,name:"application_method.allocation",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.allocation")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),!B&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(A,{form:s,ruleType:"buy-rules",scope:"application_method.buy_rules"})]}),!ge&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(A,{form:s,ruleType:"target-rules",scope:"application_method.target_rules"})]})]})})}),e.jsx(h.Content,{value:"campaign",className:"size-full overflow-auto",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:e.jsx(be,{form:s,campaigns:ye||[]})})})})]})]}),e.jsx(j.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(j.Close,{asChild:!0,children:e.jsx(k,{variant:"secondary",size:"small",children:o("actions.cancel")})}),f==="campaign"?e.jsx(k,{type:"submit",size:"small",isLoading:!1,children:o("actions.save")},"save-btn"):e.jsx(k,{type:"button",onClick:fe,size:"small",children:o("actions.continue")},"continue-btn")]})})]})})},Ct=()=>e.jsx(j,{children:e.jsx(Ke,{})});export{Ct as Component};
