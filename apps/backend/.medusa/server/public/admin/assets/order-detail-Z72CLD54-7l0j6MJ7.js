import{B as ae}from"./chunk-GXXQ33F7-DExed3w1.js";import{f as Ve}from"./chunk-4FM6S5CX-BpW1LsFY.js";import{g as Ce}from"./chunk-AMRS4CSX-D69MbOMh.js";import{f as Ye}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{f as X}from"./chunk-WATKBUHQ-C3WbDglz.js";import{g as Ge,a as ze}from"./chunk-4XSXVVYD-4qtaglB2.js";import{u as Je,a as we,b as Xe}from"./chunk-5M5ZVAWU-CColCHR1.js";import{u as Ze,a as Oe,b as Pe}from"./chunk-6IZUCU7K-Biy2GlaG.js";import{g as es,D as re}from"./chunk-PXZ7QYKX-CbuDB040.js";import{u as ss,a as de,b as ts}from"./chunk-RMEITCLS-W3RvacG6.js";import{u as as,a as is}from"./chunk-HUX22ZHT-yTIlfqIB.js";import{D as oe}from"./chunk-F7LJJHQT-B7VYfwoR.js";import{g as ns,a as ke,b as ls}from"./chunk-7DXVXBSA-u0lQbI_F.js";import{i as cs,a as k,g as O}from"./chunk-OSOI7J6Y-BoQHjEVs.js";import{i as rs,a as B}from"./chunk-B6ZOPCPA-COFsw84B.js";import{T as ie,a as ds}from"./chunk-2RQLKDBF-CaKeP8OW.js";import{u as H}from"./chunk-PFKKVLZX-DLCEsDIG.js";import{r as y,d as os,a4 as ms,a as us,bj as xs,bk as Se,bl as me,j as e,a5 as ps,s as fs,bm as hs,q as gs,b as h,u as V,bn as js,H as S,B as z,bo as Ae,U as r,ax as Te,bp as ys,A as $,bq as vs,br as _s,L as W,bh as fe,aT as K,t as w,bs as Q,M as te,a7 as M,bt as R,bu as bs,bv as Ns,bw as Cs,bx as zs,aS as ws,aW as Os,by as qe,a9 as Y,bz as Ee,ab as ks,bA as Ss,bB as As,bC as Ts,bD as qs,bE as Es,bF as Ms,bG as Is,bH as Ds}from"./index-BpfPnGdZ.js";import{u as Ls}from"./chunk-ZCZL3STK-C_Knk7Zb.js";import{A as ue}from"./arrow-path-BQBWNj2y.js";import{u as I}from"./use-prompt-Cv7F2RTx.js";import{X as xe}from"./x-circle-CP0HOC-V.js";import{P as $s}from"./pencil-square-B6or-DO4.js";import{A as U}from"./arrow-down-right-mini-LuG0iYCZ.js";import{T as Bs}from"./Trans-CBu9SpTd.js";import{C as A}from"./container-CaN4_t7k.js";import{C as L}from"./copy-xAvcOfjc.js";import{S as E}from"./status-badge-ohAqEdgy.js";import{P as q}from"./popover-Dgs2umtn.js";import"./chunk-Y2RYZS5B-DyMrZ3o1.js";import"./x-mark-mini-hOCHhWa9.js";import"./check-vtHah2d6.js";import"./prompt-CpsPiMDa.js";var Rs=Object.defineProperty,Z=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable,he=(s,t,a)=>t in s?Rs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Fs=(s,t)=>{for(var a in t||(t={}))Me.call(t,a)&&he(s,a,t[a]);if(Z)for(var a of Z(t))Ie.call(t,a)&&he(s,a,t[a]);return s},Hs=(s,t)=>{var a={};for(var i in s)Me.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&Z)for(var i of Z(s))t.indexOf(i)<0&&Ie.call(s,i)&&(a[i]=s[i]);return a};const De=y.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,n=Hs(a,["color"]);return y.createElement("svg",Fs({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},n),y.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.056 7.5H1.944M9.278 3.722 13.056 7.5l-3.778 3.778"}))});De.displayName="ArrowLongRight";var Us=Object.defineProperty,P=Object.getOwnPropertySymbols,Le=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,ge=(s,t,a)=>t in s?Us(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Ws=(s,t)=>{for(var a in t||(t={}))Le.call(t,a)&&ge(s,a,t[a]);if(P)for(var a of P(t))$e.call(t,a)&&ge(s,a,t[a]);return s},Ks=(s,t)=>{var a={};for(var i in s)Le.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&P)for(var i of P(s))t.indexOf(i)<0&&$e.call(s,i)&&(a[i]=s[i]);return a};const Be=y.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,n=Ks(a,["color"]);return y.createElement("svg",Ws({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},n),y.createElement("g",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},y.createElement("path",{d:"M1.056 4.611 7.07 7.93a.89.89 0 0 0 .858 0l6.015-3.318"}),y.createElement("path",{d:"M2.833 12.611h9.334c.982 0 1.777-.796 1.777-1.778V4.167c0-.982-.796-1.778-1.777-1.778H2.833c-.981 0-1.777.796-1.777 1.778v6.666c0 .982.796 1.778 1.777 1.778"})),y.createElement("defs",null,y.createElement("clipPath",{id:"a"},y.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});Be.displayName="Envelope";var Qs=Object.defineProperty,ee=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,je=(s,t,a)=>t in s?Qs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Vs=(s,t)=>{for(var a in t||(t={}))Re.call(t,a)&&je(s,a,t[a]);if(ee)for(var a of ee(t))Fe.call(t,a)&&je(s,a,t[a]);return s},Ys=(s,t)=>{var a={};for(var i in s)Re.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&ee)for(var i of ee(s))t.indexOf(i)<0&&Fe.call(s,i)&&(a[i]=s[i]);return a};const He=y.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,n=Ys(a,["color"]);return y.createElement("svg",Vs({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},n),y.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 1.5v5.333M11.278 4.167H3.722c-.982 0-1.778.796-1.778 1.777v5.334c0 .982.796 1.777 1.778 1.777h7.556c.982 0 1.778-.795 1.778-1.777V5.944c0-.981-.796-1.777-1.778-1.777"}),y.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.167 5.086 1.288-2.598c.3-.605.917-.988 1.593-.988h4.904c.676 0 1.293.383 1.593.988l1.288 2.599M4.167 10.833h1.777"}))});He.displayName="FlyingBox";var qa=s=>{const{id:t}=s.params||{},{order:a}=Se(t,{fields:oe},{initialData:s.data,enabled:!!t});return a?e.jsxs("span",{children:["#",a.display_id]}):null},Gs=s=>({queryKey:hs.detail(s),queryFn:async()=>fs.admin.order.retrieve(s,{fields:oe})}),Ea=async({params:s})=>{const t=s.id,a=Gs(t);return gs.ensureQueryData(a)},Js=({orderPreview:s})=>{var u;const{t}=h(),a=(u=s==null?void 0:s.order_change)==null?void 0:u.claim_id,{mutateAsync:i}=Je(a,s.id),n=V(),l=async()=>{n(`/orders/${s.id}/claims`)},d=async()=>{await i(void 0,{onSuccess:()=>{w.success(t("orders.claims.toast.canceledSuccessfully"))},onError:o=>{w.error(o.message)}})};if(a)return e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"-m-4 mb-1 border-b border-l p-4",children:e.jsx(A,{className:"flex items-center justify-between p-0",children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 px-6 pt-4",children:[e.jsx(Ae,{className:"text-ui-fg-subtle"}),e.jsx(S,{level:"h2",children:t("orders.claims.panel.title")})]}),e.jsx("div",{className:"gap-2 px-6 pb-4",children:e.jsx(r,{children:t("orders.claims.panel.description")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[e.jsx(z,{size:"small",variant:"secondary",onClick:d,children:t("orders.claims.cancel.title")}),e.jsx(z,{size:"small",variant:"secondary",onClick:l,children:t("actions.continue")})]})]})})})},Xs=({orderPreview:s})=>{var u;const{t}=h(),a=(u=s==null?void 0:s.order_change)==null?void 0:u.exchange_id,{mutateAsync:i}=Ze(a,s.id),n=V(),l=async()=>{n(`/orders/${s.id}/exchanges`)},d=async()=>{await i(void 0,{onSuccess:()=>{w.success(t("orders.exchanges.toast.canceledSuccessfully"))},onError:o=>{w.error(o.message)}})};if(a)return e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"-m-4 mb-1 border-b border-l p-4",children:e.jsx(A,{className:"flex items-center justify-between p-0",children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 px-6 pt-4",children:[e.jsx(ue,{className:"text-ui-fg-subtle"}),e.jsx(S,{level:"h2",children:t("orders.exchanges.panel.title")})]}),e.jsx("div",{className:"gap-2 px-6 pb-4",children:e.jsx(r,{children:t("orders.exchanges.panel.description")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[e.jsx(z,{size:"small",variant:"secondary",onClick:d,children:t("orders.exchanges.cancel.title")}),e.jsx(z,{size:"small",variant:"secondary",onClick:l,children:t("actions.continue")})]})]})})})},Zs=({orderPreview:s})=>{const{t}=h(),a=s==null?void 0:s.order_change,i=a==null?void 0:a.return_id,n=(a==null?void 0:a.change_type)==="return_request"&&!!a.return_id,{mutateAsync:l}=ss(i,s.id),d=V(),u=async()=>{d(`/orders/${s.id}/returns`)},o=async()=>{await l(void 0,{onSuccess:()=>{w.success(t("orders.returns.toast.canceledSuccessfully"))},onError:x=>{w.error(x.message)}})};if(!(!i||!n))return e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"-m-4 mb-1 border-b border-l p-4",children:e.jsx(A,{className:"flex items-center justify-between p-0",children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 px-6 pt-4",children:[e.jsx(Te,{className:"text-ui-fg-subtle"}),e.jsx(S,{level:"h2",children:t("orders.returns.panel.title")})]}),e.jsx("div",{className:"gap-2 px-6 pb-4",children:e.jsx(r,{children:t("orders.returns.panel.description")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[e.jsx(z,{size:"small",variant:"secondary",onClick:o,children:t("orders.returns.cancel.title")}),e.jsx(z,{size:"small",variant:"secondary",onClick:u,children:t("actions.continue")})]})]})})})};function ye({item:s,quantity:t}){return e.jsx("div",{className:"text-ui-fg-subtle items-center gap-x-2",children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs("div",{className:"w-fit min-w-[27px]",children:[e.jsx("span",{className:"txt-small tabular-nums",children:t}),"x"]}),e.jsx(K,{src:s.thumbnail}),e.jsx("span",{className:"txt-small text-ui-fg-subtle font-medium",children:s.title}),s.variant_sku&&" · ",s.variant_sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx("span",{className:"txt-small",children:s.variant_sku}),e.jsx(L,{content:s.variant_sku,className:"text-ui-fg-muted"})]})]})},s.id)}var Ps=({order:s})=>{var f,g;const{t}=h(),a=V(),{order:i}=me(s.id),{mutateAsync:n}=as(s.id),{mutateAsync:l}=is(s.id),d=((f=i.order_change)==null?void 0:f.status)==="pending",[u,o]=y.useMemo(()=>{const m=[],_=[],C=new Map(s.items.map(N=>[N.id,N]));return((i==null?void 0:i.items)||[]).forEach(N=>{const b=C.get(N.id);if(!b){m.push({item:N,quantity:N.quantity});return}b.quantity>N.quantity&&_.push({item:N,quantity:b.quantity-N.quantity}),b.quantity<N.quantity&&m.push({item:N,quantity:N.quantity-b.quantity})}),[m,_]},[i]),x=async()=>{try{await l(),w.success(t("orders.edits.toast.confirmedSuccessfully"))}catch(m){w.error(m.message)}},p=async()=>{try{await n(),w.success(t("orders.edits.toast.canceledSuccessfully"))}catch(m){w.error(m.message)}};return!i||((g=i.order_change)==null?void 0:g.change_type)!=="edit"?null:e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"-m-4 mb-1 border-b border-l p-4",children:e.jsx(A,{className:"flex items-center justify-between p-0",children:e.jsxs("div",{className:"flex w-full flex-col divide-y divide-dashed",children:[e.jsxs("div",{className:"flex items-center gap-2 px-6 py-4",children:[e.jsx(js,{className:"text-blue-500"}),e.jsx(S,{level:"h2",children:t(d?"orders.edits.panel.titlePending":"orders.edits.panel.title")})]}),!!u.length&&e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex flex-row px-6 py-4",children:[e.jsx("span",{className:"flex-1 font-medium",children:t("labels.added")}),e.jsx("div",{className:"flex flex-1 flex-col gap-y-2",children:u.map(({item:m,quantity:_})=>e.jsx(ye,{item:m,quantity:_},m.id))})]}),!!o.length&&e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex flex-row px-6 py-4",children:[e.jsx("span",{className:"flex-1 font-medium",children:t("labels.removed")}),e.jsx("div",{className:"flex flex-1 flex-col gap-y-2",children:o.map(({item:m,quantity:_})=>e.jsx(ye,{item:m,quantity:_},m.id))})]}),e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[d?e.jsx(z,{size:"small",variant:"secondary",onClick:()=>a(`/orders/${s.id}/edits`),children:t("actions.continueEdit")}):e.jsx(z,{size:"small",variant:"secondary",onClick:x,children:t("actions.forceConfirm")}),e.jsx(z,{size:"small",variant:"secondary",onClick:p,children:t("actions.cancel")})]})]})})})};function et(s){const{t}=h(),[a,i]=y.useState(!1),n=s.itemsToSend,l=s.itemsToReturn,d=s.itemsMap,u=s.title,o=()=>{i(!0)},x=()=>{i(!1)};if(!(!(n!=null&&n.length)&&!(l!=null&&l.length)))return e.jsxs(q,{open:a,children:[e.jsx(q.Trigger,{onMouseEnter:o,onMouseLeave:x,autoFocus:!1,className:"focus-visible:outline-none",children:e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:u})}),e.jsx(q.Content,{align:"center",side:"top",className:"bg-ui-bg-component max-w-[200px] p-0 focus-visible:outline-none",children:e.jsxs("div",{className:"flex flex-col",children:[!!(n!=null&&n.length)&&e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"txt-compact-small-plus mb-1",children:t("orders.activity.events.common.toSend")}),e.jsxs("div",{className:"flex flex-col",children:[n==null?void 0:n.map(p=>{const f=d==null?void 0:d.get(p.item_id);return e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[p.quantity,"x"]}),e.jsx(K,{src:f==null?void 0:f.thumbnail}),e.jsx(r,{className:"txt-compact-small text-ui-fg-subtle truncate",children:`${f==null?void 0:f.variant_title} · ${f==null?void 0:f.product_title}`})]},p.id)}),e.jsx("div",{className:"flex flex-1 flex-row items-center gap-2"})]})]}),!!(l!=null&&l.length)&&e.jsxs("div",{className:"border-t-2 border-dotted p-3",children:[e.jsx("div",{className:"txt-compact-small-plus mb-1",children:t("orders.activity.events.common.toReturn")}),e.jsxs("div",{className:"flex flex-col",children:[l==null?void 0:l.map(p=>{const f=d==null?void 0:d.get(p.item_id);return e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[p.quantity,"x"]}),e.jsx(K,{src:f==null?void 0:f.thumbnail}),e.jsx(r,{className:"txt-compact-small text-ui-fg-subtle truncate",children:`${f==null?void 0:f.variant_title} · ${f==null?void 0:f.product_title}`})]},p.id)}),e.jsx("div",{className:"flex flex-1 flex-row items-center gap-2"})]})]})]})})]})}var st=et;function tt(s){const{t}=h(),[a,i]=y.useState(!1),n=s.previous,l=s.next,d=s.title,u=()=>{i(!0)},o=()=>{i(!1)};return!n&&!l?null:e.jsxs(q,{open:a,children:[e.jsx(q.Trigger,{onMouseEnter:u,onMouseLeave:o,autoFocus:!1,className:"focus-visible:outline-none",children:e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:d})}),e.jsx(q.Content,{align:"center",side:"top",className:"bg-ui-bg-component max-w-[200px] p-0 focus-visible:outline-none",children:e.jsxs("div",{className:"flex flex-col",children:[!!n&&e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"txt-compact-small-plus mb-1",children:t("labels.from")}),e.jsx("p",{className:"txt-compact-small text-ui-fg-subtle",children:n})]}),!!l&&e.jsxs("div",{className:"border-t-2 border-dotted p-3",children:[e.jsx("div",{className:"txt-compact-small-plus mb-1",children:t("labels.to")}),e.jsx("p",{className:"txt-compact-small text-ui-fg-subtle",children:l})]})]})})]})}var ne=tt,at=["transfer","update_order"],it=({order:s})=>{const t=nt(s);if(t.length<=3)return e.jsx("div",{className:"flex flex-col gap-y-0.5",children:t.map((l,d)=>e.jsx(J,{title:l.title,timestamp:l.timestamp,isFirst:d===t.length-1,itemsToSend:l.itemsToSend,itemsToReturn:l.itemsToReturn,itemsMap:l.itemsMap,children:l.children},d))});const a=t.slice(0,2),i=t.slice(2,t.length-1),n=t[t.length-1];return e.jsxs("div",{className:"flex flex-col gap-y-0.5",children:[a.map((l,d)=>e.jsx(J,{title:l.title,timestamp:l.timestamp,itemsToSend:l.itemsToSend,itemsToReturn:l.itemsToReturn,itemsMap:l.itemsMap,children:l.children},d)),e.jsx(lt,{activities:i}),e.jsx(J,{title:n.title,timestamp:n.timestamp,isFirst:!0,itemsToSend:n.itemsToSend,itemsToReturn:n.itemsToReturn,itemsMap:n.itemsMap,children:n.children})]})},nt=s=>{const{t}=h(),{order_changes:a=[]}=As(s.id,{change_type:["edit","claim","exchange","return","transfer","update_order"]}),i=a.filter(m=>!at.includes(m.change_type)),n=ut(s,i),{order_items:l=[]}=Ts(s.id,{fields:"+quantity",item_id:n},{enabled:!!i.length}),d=y.useMemo(()=>{var _;const m=new Map((_=s==null?void 0:s.items)==null?void 0:_.map(C=>[C.id,C]));for(const C of n){const N=l.find(b=>b.item.id===C);N&&m.set(C,{...N.item,quantity:N.quantity})}return m},[s.items,l,n]),{returns:u=[]}=de({order_id:s.id,fields:"+received_at,*items"}),{claims:o=[]}=we({order_id:s.id,fields:"*additional_items"}),{exchanges:x=[]}=Oe({order_id:s.id,fields:"*additional_items"}),p=ze(s),f=[];return y.useMemo(()=>{var b,T;const m=[];for(const c of p){const j=c.amount;m.push({title:t("orders.activity.events.payment.awaiting"),timestamp:c.created_at,children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:k(j,c.currency_code)})}),c.canceled_at&&m.push({title:t("orders.activity.events.payment.canceled"),timestamp:c.canceled_at,children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:k(j,c.currency_code)})}),c.captured_at&&m.push({title:t("orders.activity.events.payment.captured"),timestamp:c.captured_at,children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:k(j,c.currency_code)})});for(const v of c.refunds||[])m.push({title:t("orders.activity.events.payment.refunded"),timestamp:v.created_at,children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:k(v.amount,c.currency_code)})})}for(const c of s.fulfillments||[])m.push({title:t("orders.activity.events.fulfillment.created"),timestamp:c.created_at,children:e.jsx(le,{fulfillment:c})}),c.delivered_at&&m.push({title:t("orders.activity.events.fulfillment.delivered"),timestamp:c.delivered_at,children:e.jsx(le,{fulfillment:c})}),c.shipped_at&&m.push({title:t("orders.activity.events.fulfillment.shipped"),timestamp:c.shipped_at,children:e.jsx(le,{fulfillment:c,isShipment:!0})}),c.canceled_at&&m.push({title:t("orders.activity.events.fulfillment.canceled"),timestamp:c.canceled_at});const _=new Map;for(const c of u)_.set(c.id,c),!(c.claim_id||c.exchange_id)&&(m.push({title:t("orders.activity.events.return.created",{returnId:c.id.slice(-7)}),timestamp:c.created_at,itemsToReturn:c==null?void 0:c.items,itemsMap:d,children:e.jsx(ve,{orderReturn:c,isCreated:!c.canceled_at})}),c.canceled_at&&m.push({title:t("orders.activity.events.return.canceled",{returnId:c.id.slice(-7)}),timestamp:c.canceled_at}),(c.status==="received"||c.status==="partially_received")&&m.push({title:t("orders.activity.events.return.received",{returnId:c.id.slice(-7)}),timestamp:c.received_at,itemsToReturn:c==null?void 0:c.items,itemsMap:d,children:e.jsx(ve,{orderReturn:c,isReceived:!0})}));for(const c of o){const j=_.get(c.return_id);m.push({title:t(c.canceled_at?"orders.activity.events.claim.canceled":"orders.activity.events.claim.created",{claimId:c.id.slice(-7)}),timestamp:c.canceled_at||c.created_at,itemsToSend:c.additional_items,itemsToReturn:j==null?void 0:j.items,itemsMap:d,children:e.jsx(ct,{claim:c,claimReturn:j})})}for(const c of x){const j=_.get(c.return_id);m.push({title:t(c.canceled_at?"orders.activity.events.exchange.canceled":"orders.activity.events.exchange.created",{exchangeId:c.id.slice(-7)}),timestamp:c.canceled_at||c.created_at,itemsToSend:c.additional_items,itemsToReturn:j==null?void 0:j.items,itemsMap:d,children:e.jsx(rt,{exchange:c,exchangeReturn:j})})}for(const c of a.filter(j=>j.change_type==="edit")){const j=c.status==="confirmed";c.status!=="pending"&&m.push({title:t(`orders.activity.events.edit.${c.status}`,{editId:c.id.slice(-7)}),timestamp:c.status==="requested"?c.requested_at:c.status==="confirmed"?c.confirmed_at:c.status==="declined"?c.declined_at:c.status==="canceled"?c.canceled_at:c.created_at,children:j?e.jsx(dt,{edit:c}):null})}for(const c of a.filter(j=>j.change_type==="transfer"))c.requested_at&&m.push({title:t("orders.activity.events.transfer.requested",{transferId:c.id.slice(-7)}),timestamp:c.requested_at,children:e.jsx(ot,{transfer:c})}),c.confirmed_at&&m.push({title:t("orders.activity.events.transfer.confirmed",{transferId:c.id.slice(-7)}),timestamp:c.confirmed_at}),c.declined_at&&m.push({title:t("orders.activity.events.transfer.declined",{transferId:c.id.slice(-7)}),timestamp:c.declined_at});for(const c of a.filter(j=>j.change_type==="update_order")){const j=(T=(b=c.actions[0])==null?void 0:b.details)==null?void 0:T.type;j==="shipping_address"&&m.push({title:e.jsx(ne,{title:t("orders.activity.events.update_order.shipping_address"),previous:B({address:c.actions[0].details.old}).join(", "),next:B({address:c.actions[0].details.new}).join(", ")}),timestamp:c.created_at,children:e.jsxs("div",{className:"text-ui-fg-subtle mt-2 flex gap-x-2 text-sm",children:[t("fields.by")," ",e.jsx(ae,{id:c.created_by})]})}),j==="billing_address"&&m.push({title:e.jsx(ne,{title:t("orders.activity.events.update_order.billing_address"),previous:B({address:c.actions[0].details.old}).join(", "),next:B({address:c.actions[0].details.new}).join(", ")}),timestamp:c.created_at,children:e.jsxs("div",{className:"text-ui-fg-subtle mt-2 flex gap-x-2 text-sm",children:[t("fields.by")," ",e.jsx(ae,{id:c.created_by})]})}),j==="email"&&m.push({title:e.jsx(ne,{title:t("orders.activity.events.update_order.email"),previous:c.actions[0].details.old,next:c.actions[0].details.new}),timestamp:c.created_at,children:e.jsxs("div",{className:"text-ui-fg-subtle mt-2 flex gap-x-2 text-sm",children:[t("fields.by")," ",e.jsx(ae,{id:c.created_by})]})})}s.canceled_at&&m.push({title:t("orders.activity.events.canceled.title"),timestamp:s.canceled_at});const C=m.sort((c,j)=>new Date(j.timestamp).getTime()-new Date(c.timestamp).getTime()),N={title:t("orders.activity.events.placed.title"),timestamp:s.created_at,children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:k(s.total,s.currency_code)})};return[...C,N]},[s,p,u,x,a,f,!1,d])},J=({title:s,timestamp:t,isFirst:a=!1,children:i,itemsToSend:n,itemsToReturn:l,itemsMap:d})=>{const{getFullDate:u,getRelativeDate:o}=H();return e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-start gap-2",children:[e.jsxs("div",{className:"flex size-full flex-col items-center gap-y-0.5",children:[e.jsx("div",{className:"flex size-5 items-center justify-center",children:e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-2.5 items-center justify-center rounded-full",children:e.jsx("div",{className:"bg-ui-tag-neutral-icon size-1.5 rounded-full"})})}),!a&&e.jsx("div",{className:"bg-ui-border-base w-px flex-1"})]}),e.jsxs("div",{className:te({"pb-4":!a}),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n!=null&&n.length||l!=null&&l.length?e.jsx(st,{title:s,itemsToSend:n,itemsToReturn:l,itemsMap:d},s):e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:s}),t&&e.jsx(M,{content:u({date:t,includeTime:!0}),children:e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-subtle text-right",children:o(t)})})]}),e.jsx("div",{children:i})]})]})},lt=({activities:s})=>{const[t,a]=y.useState(!1),{t:i}=h();return s.length?e.jsxs(qs,{open:t,onOpenChange:a,children:[!t&&e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-start gap-2",children:[e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"border-ui-border-strong w-px flex-1 bg-[linear-gradient(var(--border-strong)_33%,rgba(255,255,255,0)_0%)] bg-[length:1px_3px] bg-right bg-repeat-y"})}),e.jsx("div",{className:"pb-4",children:e.jsx(Es,{className:"text-left",children:e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-muted",children:i("orders.activity.showMoreActivities",{count:s.length})})})})]}),e.jsx(Ms,{children:e.jsx("div",{className:"flex flex-col gap-y-0.5",children:s.map((n,l)=>e.jsx(J,{title:n.title,timestamp:n.timestamp,itemsToSend:n.itemsToSend,itemsToReturn:n.itemsToReturn,itemsMap:n.itemsMap,children:n.children},l))})})]}):null},le=({fulfillment:s})=>{const{t}=h(),a=s.items.reduce((i,n)=>i+n.quantity,0);return e.jsx("div",{children:e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:t("orders.activity.events.fulfillment.items",{count:a})})})},ve=({orderReturn:s,isCreated:t,isReceived:a})=>{const i=I(),{t:n}=h(),{mutateAsync:l}=ts(s.id,s.order_id),d=async()=>{await i({title:n("orders.returns.cancel.title"),description:n("orders.returns.cancel.description"),confirmText:n("actions.confirm"),cancelText:n("actions.cancel")})&&await l()},u=s.items.reduce((o,x)=>o+(a?x.received_quantity:x.quantity),0);return e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:n("orders.activity.events.return.items",{count:u})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-[2px] flex items-center leading-none",children:"⋅"}),e.jsx(z,{onClick:d,className:"text-ui-fg-subtle h-auto px-0 leading-none hover:bg-transparent",variant:"transparent",size:"small",children:n("actions.cancel")})]})]})},ct=({claim:s,claimReturn:t})=>{const a=I(),{t:i}=h(),n=!!s.created_at,{mutateAsync:l}=Xe(s.id,s.order_id),d=async()=>{await a({title:i("orders.claims.cancel.title"),description:i("orders.claims.cancel.description"),confirmText:i("actions.confirm"),cancelText:i("actions.cancel")})&&await l()},u=(s.additional_items||[]).reduce((x,p)=>x+p.quantity,0),o=((t==null?void 0:t.items)||[]).reduce((x,p)=>x+p.quantity,0);return e.jsxs("div",{children:[u>0&&e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:i("orders.activity.events.claim.itemsInbound",{count:u})}),o>0&&e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:i("orders.activity.events.claim.itemsOutbound",{count:o})}),!n&&e.jsx(z,{onClick:d,className:"text-ui-fg-subtle h-auto px-0 leading-none hover:bg-transparent",variant:"transparent",size:"small",children:i("actions.cancel")})]})},rt=({exchange:s,exchangeReturn:t})=>{const a=I(),{t:i}=h(),n=!!s.canceled_at,{mutateAsync:l}=Pe(s.id,s.order_id),d=async()=>{await a({title:i("orders.exchanges.cancel.title"),description:i("orders.exchanges.cancel.description"),confirmText:i("actions.confirm"),cancelText:i("actions.cancel")})&&await l()},u=(s.additional_items||[]).reduce((x,p)=>x+p.quantity,0),o=((t==null?void 0:t.items)||[]).reduce((x,p)=>x+p.quantity,0);return e.jsxs("div",{children:[u>0&&e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:i("orders.activity.events.exchange.itemsInbound",{count:u})}),o>0&&e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:i("orders.activity.events.exchange.itemsOutbound",{count:o})}),!n&&e.jsx(z,{onClick:d,className:"text-ui-fg-subtle h-auto px-0 leading-none hover:bg-transparent",variant:"transparent",size:"small",children:i("actions.cancel")})]})},dt=({edit:s})=>{const{t}=h(),[a,i]=y.useMemo(()=>mt(s.actions),[s]);return e.jsxs("div",{children:[a>0&&e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[t("labels.added"),": ",a]}),i>0&&e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[t("labels.removed"),": ",i]})]})},ot=({transfer:s})=>{var o;const t=I(),{t:a}=h(),i=s.actions[0],{customer:n}=Is(i.reference_id),l=!!s.confirmed_at,{mutateAsync:d}=Ds(s.order_id),u=async()=>{await t({title:a("general.areYouSure"),description:a("actions.cannotUndo"),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await d()};return e.jsxs("div",{children:[e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[a("orders.activity.from"),": ",(o=i.details)==null?void 0:o.original_email]}),e.jsxs(r,{size:"small",className:"text-ui-fg-subtle",children:[a("orders.activity.to"),":"," ",n!=null&&n.first_name?`${n==null?void 0:n.first_name} ${n==null?void 0:n.last_name}`:n==null?void 0:n.email]}),!l&&e.jsx(z,{onClick:u,className:"text-ui-fg-subtle h-auto px-0 leading-none hover:bg-transparent",variant:"transparent",size:"small",children:a("actions.cancel")})]})};function mt(s){let t=0,a=0;return s.forEach(i=>{if(i.action==="ITEM_ADD"&&(t+=i.details.quantity),i.action==="ITEM_UPDATE"){const n=i.details.quantity_diff;n>0?t+=n:a+=Math.abs(n)}}),[t,a]}function ut(s,t){if(!(t!=null&&t.length))return[];const a=new Set,i=new Map(s.items.map(n=>[n.id,!0]));return t.forEach(n=>{n.actions.forEach(l=>{var d;(d=l.details)!=null&&d.reference_id&&l.details.reference_id.startsWith("ordli_")&&!i.has(l.details.reference_id)&&a.add(l.details.reference_id)})}),Array.from(a)}var xt=({order:s})=>{const{t}=h();return e.jsxs(A,{className:"flex flex-col gap-y-8 px-6 py-4",children:[e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(S,{level:"h2",children:t("orders.activity.header")})})}),e.jsx(it,{order:s})]})},pt=({data:s})=>{const{t}=h(),a=s.customer_id,i=jt(s),n=s.email,l=(i||n||"").charAt(0).toUpperCase();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("fields.id")}),e.jsx(W,{to:`/customers/${a}`,className:"focus:shadow-borders-focus rounded-[4px] outline-none transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-x-2 overflow-hidden",children:[e.jsx(Ss,{size:"2xsmall",fallback:l}),e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-subtle hover:text-ui-fg-base transition-fg truncate",children:i||n})]})})]})},ft=({data:s})=>{var i,n;const{t}=h(),a=((i=s.shipping_address)==null?void 0:i.company)||((n=s.billing_address)==null?void 0:n.company);return a?e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(r,{size:"small",leading:"compact",className:"truncate",children:a})]}):null},ht=({data:s})=>{var n,l;const{t}=h(),a=((n=s.shipping_address)==null?void 0:n.phone)||((l=s.billing_address)==null?void 0:l.phone),i=s.email||"";return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("orders.customer.contactLabel")}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(r,{size:"small",leading:"compact",className:"text-pretty break-all",children:i}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{content:i,className:"text-ui-fg-muted"})})]}),a&&e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(r,{size:"small",leading:"compact",className:"text-pretty break-all",children:a}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{content:i,className:"text-ui-fg-muted"})})]})]})]})},_e=({address:s,type:t})=>{const{t:a}=h();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:a(t==="shipping"?"addresses.shippingAddress.label":"addresses.billingAddress.label")}),s?e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(r,{size:"small",leading:"compact",children:B({address:s}).map((i,n)=>e.jsxs("span",{className:"break-words",children:[i,e.jsx("br",{})]},n))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{content:B({address:s}).join(`
`),className:"text-ui-fg-muted"})})]}):e.jsx(r,{size:"small",leading:"compact",children:"-"})]})},gt=({data:s})=>{const{t}=h();return e.jsxs("div",{className:"divide-y",children:[e.jsx(_e,{address:s.shipping_address,type:"shipping"}),rs(s.shipping_address,s.billing_address)?e.jsxs("div",{className:"grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("addresses.billingAddress.label")}),e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:t("addresses.billingAddress.sameAsShipping")})]}):e.jsx(_e,{address:s.billing_address,type:"billing"})]})},G=Object.assign({},{ID:pt,Company:ft,Contact:ht,Addresses:gt}),jt=s=>{const{first_name:t,last_name:a}=s.shipping_address||{},{first_name:i,last_name:n}=s.billing_address||{},{first_name:l,last_name:d}=s.customer||{},u=[l,d].filter(Boolean).join(" "),o=[t,a].filter(Boolean).join(" "),x=[i,n].filter(Boolean).join(" ");return u||o||x},yt=({order:s})=>e.jsxs(A,{className:"divide-y p-0",children:[e.jsx(vt,{}),e.jsx(G.ID,{data:s}),e.jsx(G.Contact,{data:s}),e.jsx(G.Company,{data:s}),e.jsx(G.Addresses,{data:s})]}),vt=()=>{const{t:s}=h();return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(S,{level:"h2",children:s("fields.customer")}),e.jsx($,{groups:[{actions:[{label:s("transferOwnership.label"),to:"transfer",icon:e.jsx(ue,{})}]},{actions:[{label:s("addresses.shippingAddress.editLabel"),to:"shipping-address",icon:e.jsx(He,{})},{label:s("addresses.billingAddress.editLabel"),to:"billing-address",icon:e.jsx(Os,{})}]},{actions:[{label:s("email.editLabel"),to:"email",icon:e.jsx(Be,{})}]}]})]})},_t=({order:s})=>{const t=s.fulfillments||[];return e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(Nt,{order:s}),t.map((a,i)=>e.jsx(Ct,{index:i,fulfillment:a,order:s},a.id))]})},bt=({item:s,currencyCode:t})=>{var a;return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(K,{src:s.thumbnail}),e.jsxs("div",{children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:s.title}),s.variant_sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(r,{size:"small",children:s.variant_sku}),e.jsx(L,{content:s.variant_sku,className:"text-ui-fg-muted"})]}),e.jsx(r,{size:"small",children:(a=s.variant)==null?void 0:a.options.map(i=>i.value).join(" · ")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",children:O(s.unit_price,t)})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(r,{children:[e.jsx("span",{className:"tabular-nums",children:s.quantity-s.detail.fulfilled_quantity}),"x"]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",children:O(s.subtotal||0,t)})})]})]},s.id)},Nt=({order:s})=>{const t=s.items.filter(i=>i.requires_shipping&&i.detail.fulfilled_quantity<i.quantity),a=s.items.filter(i=>!i.requires_shipping&&i.detail.fulfilled_quantity<i.quantity);return e.jsxs(e.Fragment,{children:[!!t.length&&e.jsx(be,{order:s,unfulfilledItems:t,requiresShipping:!0}),!!a.length&&e.jsx(be,{order:s,unfulfilledItems:a,requiresShipping:!1})]})},be=({order:s,unfulfilledItems:t,requiresShipping:a=!1})=>{const{t:i}=h();if(s.status!=="canceled")return e.jsxs(A,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(S,{level:"h2",children:i("orders.fulfillment.unfulfilledItems")}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[a&&e.jsx(E,{color:"red",className:"text-nowrap",children:i("orders.fulfillment.requiresShipping")}),e.jsx(E,{color:"red",className:"text-nowrap",children:i("orders.fulfillment.awaitingFulfillmentBadge")}),e.jsx($,{groups:[{actions:[{label:i("orders.fulfillment.fulfillItems"),icon:e.jsx(ks,{}),to:`/orders/${s.id}/fulfillment?requires_shipping=${a}`}]}]})]})]}),e.jsx("div",{children:t.map(n=>e.jsx(bt,{item:n,currencyCode:s.currency_code},n.id))})]})},Ct=({fulfillment:s,order:t,index:a})=>{var j;const{t:i}=h(),n=I(),l=V(),d=!!s.location_id,u=((j=s.shipping_option)==null?void 0:j.service_zone.fulfillment_set.type)==="pickup",{stock_location:o,isError:x,error:p}=Ns(s.location_id,void 0,{enabled:d});let f=s.requires_shipping?u?"Awaiting pickup":"Awaiting shipping":"Awaiting delivery",g="blue",m=s.created_at;s.canceled_at?(f="Canceled",g="red",m=s.canceled_at):s.delivered_at?(f="Delivered",g="green",m=s.delivered_at):s.shipped_at&&(f="Shipped",g="green",m=s.shipped_at);const{mutateAsync:_}=Cs(t.id,s.id),{mutateAsync:C}=zs(t.id,s.id),N=!s.canceled_at&&!s.shipped_at&&!s.delivered_at&&s.requires_shipping&&!u,b=!s.canceled_at&&!s.delivered_at,T=async()=>{await n({title:i("general.areYouSure"),description:i("orders.fulfillment.markAsDeliveredWarning"),confirmText:i("actions.continue"),cancelText:i("actions.cancel"),variant:"confirmation"})&&await C(void 0,{onSuccess:()=>{w.success(i(u?"orders.fulfillment.toast.fulfillmentPickedUp":"orders.fulfillment.toast.fulfillmentDelivered"))},onError:D=>{w.error(D.message)}})},c=async()=>{if(s.shipped_at){w.warning(i("orders.fulfillment.toast.fulfillmentShipped"));return}await n({title:i("general.areYouSure"),description:i("orders.fulfillment.cancelWarning"),confirmText:i("actions.continue"),cancelText:i("actions.cancel")})&&await _(void 0,{onSuccess:()=>{w.success(i("orders.fulfillment.toast.canceled"))},onError:D=>{w.error(D.message)}})};if(x)throw p;return e.jsxs(A,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(S,{level:"h2",children:i("orders.fulfillment.number",{number:a+1})}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(M,{content:R(new Date(m),"dd MMM, yyyy, HH:mm:ss"),children:e.jsx(E,{color:g,className:"text-nowrap",children:f})}),e.jsx($,{groups:[{actions:[{label:i("actions.cancel"),icon:e.jsx(xe,{}),onClick:c,disabled:!!s.canceled_at||!!s.shipped_at||!!s.delivered_at}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.itemsLabel")}),e.jsx("ul",{children:s.items.map(v=>e.jsx("li",{children:e.jsxs(r,{size:"small",leading:"compact",children:[v.quantity,"x ",v.title]})},v.line_item_id))})]}),d&&e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.shippingFromLabel")}),o?e.jsx(W,{to:`/settings/locations/${o.id}`,className:"text-ui-fg-interactive hover:text-ui-fg-interactive-hover transition-fg",children:e.jsx(r,{size:"small",leading:"compact",children:o.name})}):e.jsx(ws,{className:"w-16"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:i("fields.provider")}),e.jsx(r,{size:"small",leading:"compact",children:Ye(s.provider_id)})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.trackingLabel")}),e.jsx("div",{children:s.labels&&s.labels.length>0?e.jsx("ul",{children:s.labels.map(v=>v.url&&v.url.length>0&&v.url!=="#"?e.jsx("li",{children:e.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",className:"text-ui-fg-interactive hover:text-ui-fg-interactive-hover transition-fg",children:e.jsx(r,{size:"small",leading:"compact",children:v.tracking_number})})},v.tracking_number):e.jsx("li",{children:e.jsx(r,{size:"small",leading:"compact",children:v.tracking_number})},v.tracking_number))}):e.jsx(r,{size:"small",leading:"compact",children:"-"})})]}),(N||b)&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[b&&e.jsx(z,{onClick:T,variant:"secondary",children:i(u?"orders.fulfillment.markAsPickedUp":"orders.fulfillment.markAsDelivered")}),N&&e.jsx(z,{onClick:()=>l(`./${s.id}/create-shipment`),variant:"secondary",children:i("orders.fulfillment.markAsShipped")})]})]})},zt=({order:s})=>{var d;const{t}=h(),a=I(),{getFullDate:i}=H(),{mutateAsync:n}=ys(s.id),l=async()=>{await a({title:t("general.areYouSure"),description:t("orders.cancelWarning",{id:`#${s.display_id}`}),confirmText:t("actions.continue"),cancelText:t("actions.cancel")})&&await n(void 0,{onSuccess:()=>{w.success(t("orders.orderCanceled"))},onError:o=>{w.error(o.message)}})};return e.jsxs(A,{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsxs(S,{children:["#",s.display_id]}),e.jsx(L,{content:`#${s.display_id}`,className:"text-ui-fg-muted"})]}),e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:t("orders.onDateFromSalesChannel",{date:i({date:s.created_at,includeTime:!0}),salesChannel:(d=s.sales_channel)==null?void 0:d.name})})]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1.5",children:[e.jsx(kt,{order:s}),e.jsx(Ot,{order:s}),e.jsx(wt,{order:s})]}),e.jsx($,{groups:[{actions:[{label:t("actions.cancel"),onClick:l,disabled:!!s.canceled_at,icon:e.jsx(xe,{})}]}]})]})]})},wt=({order:s})=>{const{t}=h(),{label:a,color:i}=ls(t,s.fulfillment_status);return e.jsx(E,{color:i,className:"text-nowrap",children:a})},Ot=({order:s})=>{const{t}=h(),{label:a,color:i}=ke(t,s.payment_status);return e.jsx(E,{color:i,className:"text-nowrap",children:a})},kt=({order:s})=>{const{t}=h(),a=ns(t,s.status);return a?e.jsx(E,{color:a.color,className:"text-nowrap",children:a.label}):null};function St({id:s,className:t}){const{t:a}=h(),[i,n]=y.useState(!1),l=()=>{Ee(s),w.success(a("actions.idCopiedToClipboard"))};return e.jsx(M,{maxWidth:260,content:s,open:i,onOpenChange:n,children:e.jsxs("span",{onClick:l,className:te("cursor-pointer",t),children:["#",s.slice(-7)]})})}var F=St,Ue=s=>s.reduce((t,a)=>(t=t+(a.captured_amount-a.refunded_amount),t),0),At=s=>s.filter(t=>t.status!=="canceled").reduce((t,a)=>(t+=a.amount-a.captured_amount,t),0),Tt=({order:s,plugins:t})=>{const a=ze(s),i=a.map(n=>n==null?void 0:n.refunds).flat(1).filter(Boolean);return e.jsxs(A,{className:"divide-y divide-dashed p-0",children:[e.jsx(qt,{order:s}),e.jsx(It,{order:s,plugins:t,payments:a,refunds:i,currencyCode:s.currency_code}),e.jsx(Dt,{order:s})]})},qt=({order:s})=>{const{t}=h(),{label:a,color:i}=ke(t,s.payment_status);return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(S,{level:"h2",children:t("orders.payment.title")}),e.jsx(E,{color:i,className:"text-nowrap",children:a})]})},We=({refund:s,currencyCode:t})=>{const{t:a}=h(),i=(s==null?void 0:s.refund_reason)&&e.jsx(Y,{size:"2xsmall",className:"cursor-default select-none capitalize",rounded:"full",children:s.refund_reason.label}),n=s.note&&e.jsx(M,{content:s.note,children:e.jsx(re,{className:"text-ui-tag-neutral-icon ml-1 inline"})});return e.jsxs("div",{className:"bg-ui-bg-subtle text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"self-center pr-3",children:e.jsx(U,{className:"text-ui-fg-muted"})}),e.jsxs("div",{children:[e.jsxs(r,{size:"small",leading:"compact",weight:"plus",children:[a("orders.payment.refund")," ",n]}),e.jsx(r,{size:"small",leading:"compact",children:R(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]})]}),e.jsx("div",{className:"flex items-center justify-end",children:i}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(r,{size:"small",leading:"compact",children:["- ",O(s.amount,t)]})})]})},Et=({order:s,payment:t,refunds:a,currencyCode:i})=>{const{t:n}=h(),l=I(),{mutateAsync:d}=Ls(s.id,t.id),u=async()=>{await l({title:n("orders.payment.capture"),description:n("orders.payment.capturePayment",{amount:X(t.amount,i)}),confirmText:n("actions.confirm"),cancelText:n("actions.cancel"),variant:"confirmation"})&&await d({amount:t.amount},{onSuccess:()=>{w.success(n("orders.payment.capturePaymentSuccess",{amount:X(t.amount,i)}))},onError:_=>{w.error(_.message)}})},o=m=>m.canceled_at?["Canceled","red"]:m.captured_at?["Captured","green"]:["Pending","orange"],[x,p]=o(t),f=t.captured_at===null&&t.canceled_at===null,g=t.refunds.reduce((m,_)=>_.amount+m,0);return e.jsxs("div",{className:"divide-y divide-dashed",children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4 sm:grid-cols-[1fr_1fr_1fr_1fr_20px]",children:[e.jsxs("div",{className:"w-full min-w-[60px] overflow-hidden",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"truncate",children:e.jsx(F,{id:t.id})}),e.jsx(r,{size:"small",leading:"compact",children:R(new Date(t.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsx("div",{className:"hidden items-center justify-end sm:flex",children:e.jsx(r,{size:"small",leading:"compact",className:"capitalize",children:t.provider_id})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(E,{color:p,className:"text-nowrap",children:x})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",leading:"compact",children:O(t.amount,t.currency_code)})}),e.jsx($,{groups:[{actions:[{label:n("orders.payment.refund"),icon:e.jsx(xe,{}),to:`/orders/${s.id}/refund?paymentId=${t.id}`,disabled:!t.captured_at||!!t.canceled_at||g>=t.amount}]}]})]}),f&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(U,{className:"text-ui-fg-muted shrink-0"}),e.jsx(r,{size:"small",leading:"compact",children:e.jsx(Bs,{i18nKey:"orders.payment.isReadyToBeCaptured",components:[e.jsx(F,{id:t.id})]})})]}),e.jsxs(z,{className:"shrink-0",size:"small",variant:"secondary",onClick:u,children:[e.jsx("span",{className:"hidden sm:block",children:n("orders.payment.capture")}),e.jsx("span",{className:"sm:hidden",children:n("orders.payment.capture_short")})]})]}),a.map(m=>e.jsx(We,{refund:m,currencyCode:i},m.id))]})},Mt=({creditLine:s,currencyCode:t,plugins:a})=>{var d;const i=Ce(a);if(!i)return null;const n=(d=s.reference)==null?void 0:d.split("_").join(" ").split("-").join(" "),l=s.reference_id?e.jsx(F,{id:s.reference_id}):null;return e.jsx("div",{className:"divide-y divide-dashed",children:e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-[1fr_1fr_20px] items-center gap-x-4 px-6 py-4 sm:grid-cols-[1fr_1fr_1fr_20px]",children:[e.jsxs("div",{className:"w-full min-w-[60px] overflow-hidden",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"truncate",children:i?e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:"Store credit refund"}):e.jsx(F,{id:s.id})}),e.jsx(r,{size:"small",leading:"compact",children:R(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsx("div",{className:"hidden items-center justify-end sm:flex",children:e.jsxs(r,{size:"small",leading:"compact",className:"capitalize",children:[n," (",l,")"]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",leading:"compact",children:O(s.amount,t)})})]})})},It=({order:s,payments:t,refunds:a,currencyCode:i,plugins:n})=>{const l=a.filter(x=>x.payment_id===null),u=(s.credit_lines??[]).filter(x=>x.amount<0),o=[...l,...t,...u].sort((x,p)=>new Date(x.created_at).getTime()-new Date(p.created_at).getTime()).map(x=>{let p=x.id.startsWith("pay_")?"payment":"refund";return x.id.startsWith("ordcl_")&&(p="credit_line_refund"),{event:x,type:p}});return e.jsx("div",{className:"flex flex-col divide-y divide-dashed",children:o.map(({type:x,event:p})=>{switch(x){case"payment":return e.jsx(Et,{order:s,payment:p,refunds:a.filter(f=>f.payment_id===p.id),currencyCode:i},p.id);case"refund":return e.jsx(We,{refund:p,currencyCode:i},p.id);case"credit_line_refund":return e.jsx(Mt,{creditLine:p,currencyCode:i,plugins:n},p.id)}})})},Dt=({order:s})=>{const{t}=h(),a=At(s.payment_collections);return e.jsxs("div",{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{size:"small",weight:"plus",leading:"compact",children:t("orders.payment.totalPaidByCustomer")}),e.jsx(r,{size:"small",weight:"plus",leading:"compact",children:k(Ue(s.payment_collections),s.currency_code)})]}),s.status!=="canceled"&&a>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{size:"small",weight:"plus",leading:"compact",children:"Total pending"}),e.jsx(r,{size:"small",weight:"plus",leading:"compact",children:k(a,s.currency_code)})]})]})},Ne=s=>s.reduce((t,a)=>(t=t+a.amount,t),0),Lt="",Ke=fe.forwardRef(({paymentCollection:s,order:t},a)=>{const[i,n]=y.useState(!1),[l,d]=y.useState(!1),[u,o]=y.useState("CopyPaymentLink"),{t:x}=h(),p=async f=>{f.stopPropagation(),n(!0),Ee(`${Lt}/payment-collection/${s.id}`),setTimeout(()=>{n(!1)},2e3)};return fe.useEffect(()=>{if(i){o(x("actions.copied"));return}setTimeout(()=>{o(x("actions.copy"))},500)},[i]),e.jsx(M,{content:u,open:i||l,onOpenChange:d,children:e.jsxs(z,{ref:a,variant:"secondary",size:"small","aria-label":"CopyPaymentLink code snippet",onClick:p,children:[i?e.jsx(bs,{className:"inline"}):e.jsx(ds,{className:"inline"}),x("orders.payment.paymentLink",{amount:k(s.amount,t==null?void 0:t.currency_code)})]})})});Ke.displayName="CopyPaymentLink";function $t({orderReturn:s}){const{t}=h(),[a,i]=y.useState(!1),{getFullDate:n}=H(),l=()=>{i(!0)},d=()=>{i(!1)};let u="Return",o=s.id;if(s.claim_id&&(u="Claim",o=s.claim_id),s.exchange_id&&(u="Exchange",o=s.exchange_id),typeof s=="object")return e.jsxs(q,{open:a,children:[e.jsx(q.Trigger,{onMouseEnter:l,onMouseLeave:d,autoFocus:!1,className:"align-sub focus-visible:outline-none",children:e.jsx(qe,{})}),e.jsx(q.Content,{align:"center",side:"top",className:"bg-ui-bg-component p-2 focus-visible:outline-none",children:e.jsxs("div",{className:"",children:[e.jsxs(Y,{size:"2xsmall",className:"mb-2",rounded:"full",children:[u,": #",o.slice(-7)]}),e.jsxs(r,{size:"xsmall",children:[e.jsx("span",{className:"text-ui-fg-subtle",children:t("orders.returns.returnRequested")})," · ",n({date:s.requested_at,includeTime:!0})]}),e.jsxs(r,{size:"xsmall",children:[e.jsx("span",{className:"text-ui-fg-subtle",children:t("orders.returns.itemReceived")})," · ",s.received_at?n({date:s.received_at,includeTime:!0}):"-"]})]})})]})}var ce=$t;function Bt({shippingMethod:s}){const{t}=h(),a=s==null?void 0:s.detail;if(!a)return;let i=t("orders.return"),n=a.return_id;if(a.claim_id&&(i=t("orders.claim"),n=a.claim_id),a.exchange_id&&(i=t("orders.exchange"),n=a.exchange_id),!!n)return e.jsx(M,{content:e.jsxs(Y,{size:"2xsmall",rounded:"full",children:[i,": #",n.slice(-7)]}),children:e.jsx(qe,{className:"inline-block text-ui-fg-muted ml-1"})})}var Rt=Bt,Ft=({order:s,plugins:t})=>{var b,T;const{t:a}=h(),i=I(),{reservations:n}=vs({line_item_id:(b=s==null?void 0:s.items)==null?void 0:b.map(c=>c.id),limit:Ge(s)},{enabled:Array.isArray(s==null?void 0:s.items)}),{order:l}=me(s.id),{returns:d=[]}=de({status:"requested",order_id:s.id,fields:"+received_at"}),u=y.useMemo(()=>d.filter(c=>!c.canceled_at),[d]),o=!!u.length,x=y.useMemo(()=>{var j;if(!n)return!1;const c=new Map(n.map(v=>[v.line_item_id,v.id]));for(const v of s.items)if((j=v.variant)!=null&&j.manage_inventory&&v.quantity-v.detail.fulfilled_quantity>0&&!c.has(v.id))return!0;return!1},[s.items,n]),p=s.payment_collections.find(c=>c.status==="not_paid"),{mutateAsync:f}=_s(s.id,p==null?void 0:p.id),g=((T=s.summary)==null?void 0:T.pending_difference)||0,m=!cs(g,s.currency_code),_=p&&g>0&&m,C=g<0&&m,N=async c=>{await i({title:a("orders.payment.markAsPaid"),description:a("orders.payment.markAsPaidPayment",{amount:X(c.amount,s.currency_code)}),confirmText:a("actions.confirm"),cancelText:a("actions.cancel"),variant:"confirmation"})&&await f({order_id:s.id},{onSuccess:()=>{w.success(a("orders.payment.markAsPaidPaymentSuccess",{amount:X(c.amount,s.currency_code)}))},onError:v=>{w.error(v.message)}})};return e.jsxs(A,{className:"divide-y divide-dashed p-0",children:[e.jsx(Ht,{order:s,orderPreview:l}),e.jsx(Wt,{order:s,reservations:n}),e.jsx(Kt,{order:s}),e.jsx(Qt,{order:s,plugins:t}),e.jsx(Zt,{order:s}),(x||o||_||C)&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-end gap-x-2 rounded-b-xl px-4 py-4",children:[o&&(u.length===1?e.jsx(z,{asChild:!0,variant:"secondary",size:"small",children:e.jsx(W,{to:`/orders/${s.id}/returns/${u[0].id}/receive`,children:a("orders.returns.receive.action")})}):e.jsx($,{groups:[{actions:u.map(c=>{let j=c.id,v="Return";return c.exchange_id&&(j=c.exchange_id,v="Exchange"),c.claim_id&&(j=c.claim_id,v="Claim"),{label:a("orders.returns.receive.receiveItems",{id:`#${j.slice(-7)}`,returnType:v}),icon:e.jsx(De,{}),to:`/orders/${s.id}/returns/${c.id}/receive`}})}],children:e.jsx(z,{variant:"secondary",size:"small",children:a("orders.returns.receive.action")})})),x&&e.jsx(z,{asChild:!0,variant:"secondary",size:"small",children:e.jsx(W,{to:"allocate-items",children:a("orders.allocateItems.action")})}),_&&e.jsx(Ke,{paymentCollection:p,order:s}),_&&e.jsx(z,{size:"small",variant:"secondary",onClick:()=>N(p),children:a("orders.payment.markAsPaid")}),C&&e.jsx(z,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(W,{to:`/orders/${s.id}/refund`,children:a("orders.payment.refundAmount",{amount:k(g*-1,s==null?void 0:s.currency_code)})})})]})]})},Ht=({order:s,orderPreview:t})=>{var d,u,o,x,p,f,g,m,_,C,N,b,T,c,j,v,D,pe;const{t:a}=h(),i=s.items.every(Qe=>!(es(Qe)>0)),n=((d=t==null?void 0:t.order_change)==null?void 0:d.change_type)==="edit",l=((u=t==null?void 0:t.order_change)==null?void 0:u.change_type)==="edit"&&((o=t==null?void 0:t.order_change)==null?void 0:o.status)==="pending";return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(S,{level:"h2",children:a("fields.summary")}),e.jsx($,{groups:[{actions:[{label:a(l?"orders.summary.editOrderContinue":"orders.summary.editOrder"),to:`/orders/${s.id}/edits`,icon:e.jsx($s,{}),disabled:s.status==="canceled"||(t==null?void 0:t.order_change)&&((x=t==null?void 0:t.order_change)==null?void 0:x.change_type)!=="edit"||((p=t==null?void 0:t.order_change)==null?void 0:p.change_type)==="edit"&&((f=t==null?void 0:t.order_change)==null?void 0:f.status)==="requested"}]},{actions:[{label:a("orders.returns.create"),to:`/orders/${s.id}/returns`,icon:e.jsx(Te,{}),disabled:i||n||!!((g=t==null?void 0:t.order_change)!=null&&g.exchange_id)||!!((m=t==null?void 0:t.order_change)!=null&&m.claim_id)},{label:(_=t==null?void 0:t.order_change)!=null&&_.id&&((C=t==null?void 0:t.order_change)!=null&&C.exchange_id)?a("orders.exchanges.manage"):a("orders.exchanges.create"),to:`/orders/${s.id}/exchanges`,icon:e.jsx(ue,{}),disabled:i||n||!!((N=t==null?void 0:t.order_change)!=null&&N.return_id)&&!((b=t==null?void 0:t.order_change)!=null&&b.exchange_id)||!!((T=t==null?void 0:t.order_change)!=null&&T.claim_id)},{label:(c=t==null?void 0:t.order_change)!=null&&c.id&&((j=t==null?void 0:t.order_change)!=null&&j.claim_id)?a("orders.claims.manage"):a("orders.claims.create"),to:`/orders/${s.id}/claims`,icon:e.jsx(Ae,{}),disabled:i||n||!!((v=t==null?void 0:t.order_change)!=null&&v.return_id)&&!((D=t==null?void 0:t.order_change)!=null&&D.claim_id)||!!((pe=t==null?void 0:t.order_change)!=null&&pe.exchange_id)}]}]})]})},Ut=({item:s,currencyCode:t,reservation:a,returns:i,claims:n,exchanges:l})=>{var p,f,g,m,_,C,N;const{t:d}=h(),u=(p=s.variant)==null?void 0:p.manage_inventory,o=u&&((((g=(f=s.variant)==null?void 0:f.inventory_items)==null?void 0:g.length)||0)>1||((_=(m=s.variant)==null?void 0:m.inventory_items)==null?void 0:_.some(b=>b.required_quantity>1))),x=s.quantity-s.detail.fulfilled_quantity>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(K,{src:s.thumbnail}),e.jsxs("div",{children:[e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-base",children:s.title}),s.variant_sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(r,{size:"small",children:s.variant_sku}),e.jsx(L,{content:s.variant_sku,className:"text-ui-fg-muted"})]}),e.jsx(r,{size:"small",children:(N=(C=s.variant)==null?void 0:C.options)==null?void 0:N.map(b=>b.value).join(" · ")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-x-4",children:e.jsx(r,{size:"small",children:O(s.unit_price,t)})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("div",{className:"w-fit min-w-[27px]",children:e.jsxs(r,{size:"small",children:[e.jsx("span",{className:"tabular-nums",children:s.quantity}),"x"]})}),e.jsx("div",{className:"overflow-visible",children:u&&x&&e.jsx(E,{color:a?"green":"orange",className:"text-nowrap",children:d(a?"orders.reservations.allocatedLabel":"orders.reservations.notAllocatedLabel")})})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",className:"pt-[1px]",children:O(s.subtotal||0,t)})})]})]},s.id),o&&e.jsx(Vt,{item:s}),i.map(b=>e.jsx(Gt,{orderReturn:b,itemId:s.id},b.id)),n.map(b=>e.jsx(Jt,{claim:b,itemId:s.id},b.id)),l.map(b=>e.jsx(Xt,{exchange:b,itemId:s.id},b.id))]})},Wt=({order:s,reservations:t})=>{var d;const{claims:a=[]}=we({order_id:s.id,fields:"*additional_items"}),{exchanges:i=[]}=Oe({order_id:s.id,fields:"*additional_items"}),{returns:n=[]}=de({order_id:s.id,fields:"*items,*items.reason"}),l=y.useMemo(()=>new Map((t||[]).map(u=>[u.line_item_id,u])),[t]);return e.jsx("div",{children:(d=s.items)==null?void 0:d.map(u=>{const o=l.get(u.id);return e.jsx(Ut,{item:u,currencyCode:s.currency_code,reservation:o,returns:n,exchanges:i,claims:a},u.id)})})},se=({label:s,value:t,secondaryValue:a,tooltip:i})=>e.jsxs("div",{className:"grid grid-cols-3 items-center",children:[e.jsxs(r,{size:"small",leading:"compact",children:[s," ",i]}),e.jsx("div",{className:"text-right",children:e.jsx(r,{size:"small",leading:"compact",children:a})}),e.jsx("div",{className:"text-right",children:e.jsx(r,{size:"small",leading:"compact",children:t})})]}),Kt=({order:s})=>{const{t}=h(),[a,i]=y.useState(!1),[n,l]=y.useState(!1),d=y.useMemo(()=>{const o={};return s.items.forEach(x=>{var p;(p=x.tax_lines)==null||p.forEach(f=>{var m;const g=((m=o[f.code])==null?void 0:m.total)||0;o[f.code]={total:g+f.subtotal,rate:f.rate}})}),s.shipping_methods.forEach(x=>{var p;(p=x.tax_lines)==null||p.forEach(f=>{var m;const g=((m=o[f.code])==null?void 0:m.total)||0;o[f.code]={total:g+f.subtotal,rate:f.rate}})}),o},[s]),u=!!Object.keys(d).length;return e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2 px-6 py-4",children:[e.jsx(se,{label:t("orders.summary.itemSubtotal"),value:O(s.item_subtotal,s.currency_code)}),e.jsx(se,{label:e.jsxs("div",{onClick:()=>l(o=>!o),className:"flex cursor-pointer items-center gap-1",children:[e.jsx("span",{children:t("orders.summary.shippingSubtotal")}),e.jsx(Q,{style:{transform:`rotate(${n?0:-90}deg)`}})]}),value:O(s.shipping_subtotal,s.currency_code)}),n&&e.jsx("div",{className:"flex flex-col gap-1 pl-5",children:(s.shipping_methods||[]).sort((o,x)=>o.created_at.localeCompare(x.created_at)).map((o,x)=>e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsx("div",{children:e.jsxs("span",{className:"txt-small",children:[o.name,o.detail.return_id&&` (${t("fields.returnShipping")})`," ",e.jsx(Rt,{shippingMethod:o},x)]})}),e.jsx("div",{className:"relative flex-1",children:e.jsx("div",{className:"bottom-[calc(50% - 2px)] absolute h-[1px] w-full border-b border-dashed"})}),e.jsx("span",{className:"txt-small text-ui-fg-muted",children:O(o.subtotal,s.currency_code)})]},o.id))}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{onClick:()=>u&&i(o=>!o),className:te("flex items-center gap-1",{"cursor-pointer":u}),children:[e.jsx("span",{className:"txt-small select-none",children:t("orders.summary.taxTotal")}),u&&e.jsx(Q,{style:{transform:`rotate(${a?0:-90}deg)`}})]}),e.jsx("div",{className:"text-right",children:e.jsx(r,{size:"small",leading:"compact",children:O(s.original_tax_total,s.currency_code)})})]}),a&&e.jsx("div",{className:"flex flex-col gap-1 pl-5",children:Object.entries(d).map(([o,{total:x,rate:p}])=>e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"txt-small",children:o}),e.jsxs("span",{className:"txt-small",children:["(",Ve(p),")"]})]}),e.jsx("div",{className:"relative flex-1",children:e.jsx("div",{className:"bottom-[calc(50% - 2px)] absolute h-[1px] w-full border-b border-dashed"})}),e.jsx("span",{className:"txt-small text-ui-fg-muted",children:O(x,s.currency_code)})]},o))})]}),e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:t("fields.total")}),e.jsx(r,{className:"text-ui-fg-subtle text-bold",size:"small",leading:"compact",children:O(s.original_total,s.currency_code)})]})]})},Qt=({order:s,plugins:t})=>{const{t:a}=h(),[i,n]=y.useState(!1),[l,d]=y.useState(!1),u=s.credit_lines??[],o=Ce(t),x=y.useMemo(()=>{const g=[];return s.item_discount_total&&g.push({type:"item",total:s.item_discount_total,codes:Array.from(new Set(s.items.flatMap(m=>m.adjustments||[]).map(m=>m.code))).sort()}),s.shipping_discount_total&&g.push({type:"shipping",total:s.shipping_discount_total,codes:Array.from(new Set(s.shipping_methods.flatMap(m=>m.adjustments||[]).map(m=>m.code))).sort()}),g},[s]),p=x.length>0,f=u.length>0;return e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2 px-6 py-4",children:[e.jsx(se,{label:e.jsxs("div",{onClick:()=>p&&n(g=>!g),className:te("flex items-center gap-1",{"cursor-pointer":p}),children:[e.jsx("span",{children:a("orders.summary.discountTotal")}),p&&e.jsx(Q,{style:{transform:`rotate(${i?0:-90}deg)`}})]}),value:O(s.discount_total,s.currency_code)}),i&&e.jsx("div",{className:"flex flex-col gap-1 pl-5",children:x.map(({type:g,total:m,codes:_})=>e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"txt-small",children:a(`fields.${g}`)}),e.jsxs("span",{className:"txt-small",children:["(",_.join(", "),")"]})]}),e.jsx("div",{className:"relative flex-1",children:e.jsx("div",{className:"bottom-[calc(50% - 2px)] absolute h-[1px] w-full border-b border-dashed"})}),e.jsx("span",{className:"txt-small text-ui-fg-muted",children:O(m,s.currency_code)})]},g))}),f&&e.jsxs(e.Fragment,{children:[e.jsx(se,{label:e.jsxs("div",{onClick:()=>d(g=>!g),className:"flex cursor-pointer items-center gap-1",children:[e.jsx("span",{children:a(o?"orders.giftCardsStoreCreditLines":"orders.creditLines.title")}),e.jsx(Q,{style:{transform:`rotate(${l?0:-90}deg)`}})]}),value:O(s.credit_line_total,s.currency_code)}),l&&e.jsx("div",{className:"flex flex-col gap-1 pl-5",children:u.map(g=>{var C;const m=(C=g.reference)==null?void 0:C.split("_").join(" ").split("-").join(" "),_=g.reference_id?e.jsx(F,{id:g.reference_id}):null;return e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"txt-small text-ui-fg-subtle font-medium",children:e.jsx(F,{id:g.id})}),e.jsx("span",{className:"txt-small text-ui-fg-subtle mx-1",children:"-"}),e.jsx(M,{content:R(new Date(g.created_at),"dd MMM, yyyy, HH:mm:ss"),children:e.jsx(r,{size:"small",leading:"compact",className:"txt-small text-ui-fg-subtle",children:R(new Date(g.created_at),"dd MMM, yyyy")})}),e.jsx("span",{className:"txt-small text-ui-fg-subtle mx-1",children:"-"}),e.jsxs(r,{size:"small",leading:"compact",className:"txt-small text-ui-fg-subtle capitalize",children:["(",m," ",_,")"]})]}),e.jsx("div",{className:"relative flex-1",children:e.jsx("div",{className:"bottom-[calc(50% - 2px)] absolute h-[1px] w-full border-b border-dashed"})}),e.jsx("span",{className:"txt-small text-ui-fg-muted",children:O(g.amount,s.currency_code)})]},g.id)})})]}),e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:a("orders.summary.totalAfterDiscount")}),e.jsx(r,{className:"text-ui-fg-subtle text-bold",size:"small",leading:"compact",children:O(s.total,s.currency_code)})]})]})},Vt=({item:s})=>{var l;const{t}=h(),[a,i]=y.useState(!1),n=((l=s.variant)==null?void 0:l.inventory_items)||[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{onClick:()=>i(d=>!d),className:"flex cursor-pointer items-center gap-2 border-t border-dashed px-6 py-4",children:[e.jsx(Q,{style:{transform:`rotate(${a?0:-90}deg)`}}),e.jsx("span",{className:"text-ui-fg-muted txt-small select-none",children:t("orders.summary.inventoryKit",{count:n.length})})]}),a&&e.jsx("div",{className:"flex flex-col gap-1 px-6 pb-4",children:n.map(d=>e.jsxs("div",{className:"flex items-center justify-between gap-x-2",children:[e.jsx("div",{children:e.jsxs("span",{className:"txt-small text-ui-fg-subtle font-medium",children:[d.inventory.title,d.inventory.sku&&e.jsxs("span",{className:"text-ui-fg-subtle font-normal",children:[" ","⋅ ",d.inventory.sku]})]})}),e.jsx("div",{className:"relative flex-1",children:e.jsx("div",{className:"bottom-[calc(50% - 2px)] absolute h-[1px] w-full border-b border-dashed"})}),e.jsxs("span",{className:"txt-small text-ui-fg-muted",children:[d.required_quantity,"x"]})]},d.inventory.id))})]})},Yt=({orderReturn:s,itemId:t})=>{var l,d;const{t:a}=h(),i=(l=s==null?void 0:s.items)==null?void 0:l.find(u=>u.item_id===t),n=(i==null?void 0:i.damaged_quantity)||0;return i&&e.jsxs("div",{className:"txt-compact-small-plus text-ui-fg-subtle bg-ui-bg-subtle flex flex-row justify-between gap-y-2 border-t-2 border-dotted px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"text-ui-fg-muted"}),e.jsx(r,{size:"small",children:a("orders.returns.damagedItemsReturned",{quantity:n})}),(i==null?void 0:i.note)&&e.jsx(M,{content:i.note,children:e.jsx(re,{className:"text-ui-tag-neutral-icon ml-1 inline"})}),(i==null?void 0:i.reason)&&e.jsx(Y,{size:"2xsmall",className:"cursor-default select-none capitalize",rounded:"full",children:(d=i==null?void 0:i.reason)==null?void 0:d.label})]}),e.jsxs(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:[a("orders.returns.damagedItemReceived"),e.jsx("span",{className:"ml-2",children:e.jsx(ce,{orderReturn:s})})]})]},s.id)},Gt=({orderReturn:s,itemId:t})=>{var u,o;const{t:a}=h(),{getRelativeDate:i}=H();if(!["requested","received","partially_received"].includes(s.status||""))return null;const n=s.status==="requested",l=(u=s==null?void 0:s.items)==null?void 0:u.find(x=>x.item_id===t),d=(l==null?void 0:l.damaged_quantity)||0;return l&&e.jsxs(e.Fragment,{children:[d>0&&e.jsx(Yt,{orderReturn:s,itemId:t}),e.jsxs("div",{className:"txt-compact-small-plus text-ui-fg-subtle bg-ui-bg-subtle flex flex-row justify-between gap-y-2 border-t-2 border-dotted px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"text-ui-fg-muted"}),e.jsx(r,{size:"small",children:a(`orders.returns.${n?"returnRequestedInfo":"returnReceivedInfo"}`,{requestedItemsCount:l==null?void 0:l[n?"quantity":"received_quantity"]})}),(l==null?void 0:l.note)&&e.jsx(M,{content:l.note,children:e.jsx(re,{className:"text-ui-tag-neutral-icon ml-1 inline"})}),(l==null?void 0:l.reason)&&e.jsx(Y,{size:"2xsmall",className:"cursor-default select-none capitalize",rounded:"full",children:(o=l==null?void 0:l.reason)==null?void 0:o.label})]}),s&&n&&e.jsxs(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:[i(s.created_at),e.jsx("span",{className:"ml-2",children:e.jsx(ce,{orderReturn:s})})]}),s&&!n&&e.jsxs(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:[a("orders.returns.itemReceived"),e.jsx("span",{className:"ml-2",children:e.jsx(ce,{orderReturn:s})})]})]},l.id)]})},Jt=({claim:s,itemId:t})=>{const{t:a}=h(),{getRelativeDate:i}=H(),n=s.additional_items.filter(l=>{var d;return((d=l.item)==null?void 0:d.id)===t});return!!n.length&&e.jsxs("div",{className:"txt-compact-small-plus text-ui-fg-subtle bg-ui-bg-subtle flex flex-row justify-between gap-y-2 border-b-2 border-t-2 border-dotted px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"text-ui-fg-muted"}),e.jsx(r,{size:"small",children:a("orders.claims.outboundItemAdded",{itemsCount:n.reduce((l,d)=>l=l+d.quantity,0)})})]}),e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:i(s.created_at)})]},s.id)},Xt=({exchange:s,itemId:t})=>{const{t:a}=h(),{getRelativeDate:i}=H(),n=s.additional_items.filter(l=>{var d;return((d=l==null?void 0:l.item)==null?void 0:d.id)===t});return!!n.length&&e.jsxs("div",{className:"txt-compact-small-plus text-ui-fg-subtle bg-ui-bg-subtle flex flex-row justify-between gap-y-2 border-b-2 border-t-2 border-dotted px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"text-ui-fg-muted"}),e.jsx(r,{size:"small",children:a("orders.exchanges.outboundItemAdded",{itemsCount:n.reduce((l,d)=>l=l+d.quantity,0)})})]}),e.jsx(r,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:i(s.created_at)})]},s.id)},Zt=({order:s})=>{const{t}=h();return e.jsxs("div",{className:" flex flex-col gap-y-2 px-6 py-4",children:[e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:t("fields.paidTotal")}),e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:k(Ue(s.payment_collections||[]),s.currency_code)})]}),Ne(s.credit_lines??[])>0&&e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:t("fields.creditTotal")}),e.jsx(r,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:k(Ne(s.credit_lines??[]),s.currency_code)})]}),e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(r,{className:"text-ui-fg-subtle text-semibold",size:"small",leading:"compact",children:t("orders.returns.outstandingAmount")}),e.jsx(r,{className:"text-ui-fg-subtle text-bold",size:"small",leading:"compact",children:k(s.summary.pending_difference||0,s.currency_code)})]})]})},Ma=()=>{const s=os(),{id:t}=ms(),{getWidgets:a}=us(),{plugins:i=[]}=xs(),{order:n,isLoading:l,isError:d,error:u}=Se(t,{fields:oe},{initialData:s});n&&(n.items=n.items.sort((p,f)=>p.created_at>f.created_at?1:p.created_at<f.created_at?-1:0));const{order:o,isLoading:x}=me(t);if(l||!n||x)return e.jsx(ps,{mainSections:4,sidebarSections:2,showJSON:!0});if(d)throw u;return e.jsxs(ie,{widgets:{after:a("order.details.after"),before:a("order.details.before"),sideAfter:a("order.details.side.after"),sideBefore:a("order.details.side.before")},data:n,showJSON:!0,showMetadata:!0,hasOutlet:!0,children:[e.jsxs(ie.Main,{children:[e.jsx(Ps,{order:n}),e.jsx(Js,{orderPreview:o}),e.jsx(Xs,{orderPreview:o}),e.jsx(Zs,{orderPreview:o}),e.jsx(zt,{order:n}),e.jsx(Ft,{order:n,plugins:i}),e.jsx(Tt,{order:n,plugins:i}),e.jsx(_t,{order:n})]}),e.jsxs(ie.Sidebar,{children:[e.jsx(yt,{order:n}),e.jsx(xt,{order:n})]})]})};export{qa as Breadcrumb,Ma as Component,Ea as loader};
